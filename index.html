
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Currency Formats Reference</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    /* 1. VARIABLES AND BASE STYLES */
    :root {
      /* Light Theme */
      --color-bg: #F9FAFB; --color-surface: #FFFFFF; --color-surface-hover: rgba(59, 130, 246, 0.1); --color-primary: #3B82F6; --color-primary-a: rgba(59, 130, 246, 0.15); --color-button-text: #FFFFFF; --color-text-primary: #1F2937; --color-text-secondary: #6B7280; --color-border: #E5E7EB;
      --color-success: #16A34A;
      --color-danger: #EF4444;
      --color-warning: #F59E0B;
      --color-unique: #9C27B0;
      --color-active-col-bg: rgba(59, 130, 246, 0.1);
      --color-row-even-bg: #F3F4F6;

      /* Muted Tag Colors (Light Theme) */
      --tag-euro-bg: #EFF6FF; --tag-euro-text: #1E40AF; --tag-euro-border: #BFDBFE;
      --tag-dollar-bg: #F0FDF4; --tag-dollar-text: #166534; --tag-dollar-border: #BBF7D0;
      --tag-other-bg: #EEF2FF; --tag-other-text: #3730A3; --tag-other-border: #C7D2FE;
      --tag-closed-bg: #F3F4F6; --tag-closed-text: #374151; --tag-closed-border: #E5E7EB;
      --tag-eu-bg: #FEFCE8; --tag-eu-text: #A16207; --tag-eu-border: #FDE047;
      --tag-tier-bg: #F5F3FF; --tag-tier-text: #5B21B6; --tag-tier-border: #DDD6FE;
      --tag-nbsp-bg: #FFF7ED; --tag-nbsp-text: #9A3412; --tag-nbsp-border: #FED7AA;
      
      --tag-en-bg: #EFF6FF; --tag-en-text: #1E40AF; --tag-en-border: #BFDBFE;
      --tag-de-bg: #FDF2F8; --tag-de-text: #9D2667; --tag-de-border: #FBCFE8;
      --tag-nl-bg: #FFF7ED; --tag-nl-text: #9A3412; --tag-nl-border: #FED7AA;
      --tag-pt-bg: #F0FDF4; --tag-pt-text: #166534; --tag-pt-border: #BBF7D0;
      --tag-ar-bg: #F0FDF4; --tag-ar-text: #166534; --tag-ar-border: #BBF7D0;
      --tag-it-bg: #EFF6FF; --tag-it-text: #1E40AF; --tag-it-border: #BFDBFE;
      --tag-fr-bg: #EFF6FF; --tag-fr-text: #1E40AF; --tag-fr-border: #BFDBFE;
      --tag-es-bg: #FEF2F2; --tag-es-text: #991B1B; --tag-es-border: #FECACA;
      --tag-et-bg: #F0F9FF; --tag-et-text: #0C4A6E; --tag-et-border: #BAE6FD;
    }
    [data-theme="dark"] {
      /* Dark Theme */
      --color-bg: #111827; --color-surface: #1F2937; --color-surface-hover: #374151; --color-primary: #00BCD4; --color-primary-a: rgba(96, 165, 250, 0.15); --color-button-text: #111827; --color-text-primary: #E9FAFA; --color-text-secondary: #B0BEC5; --color-border: #374151;
      --color-success: #4AAA80;
      --color-danger: #FCA5A5;
      --color-warning: #FFC107;
      --color-unique: #EF4444;
      --color-active-col-bg: rgba(96, 165, 250, 0.1);
      --color-row-even-bg: var(--color-bg);

      /* Muted Tag Colors (Dark Theme) */
      --tag-euro-bg: #1E293B; --tag-euro-text: #93C5FD; --tag-euro-border: #334155;
      --tag-dollar-bg: #1F2923; --tag-dollar-text: #86EFAC; --tag-dollar-border: #223B2C;
      --tag-other-bg: #252336; --tag-other-text: #A5B4FC; --tag-other-border: #393653;
      --tag-closed-bg: #374151; --tag-closed-text: #D1D5DB; --tag-closed-border: #4B5563;
      --tag-eu-bg: #332C1B; --tag-eu-text: #FDE047; --tag-eu-border: #564826;
      --tag-tier-bg: #2A2441; --tag-tier-text: #A78BFA; --tag-tier-border: #453B6C;
      --tag-nbsp-bg: #3F271A; --tag-nbsp-text: #FB923C; --tag-nbsp-border: #69412B;
      
      --tag-en-bg: #1E293B; --tag-en-text: #93C5FD; --tag-en-border: #334155;
      --tag-de-bg: #401A29; --tag-de-text: #F9A8D4; --tag-de-border: #572A3F;
      --tag-nl-bg: #3F271A; --tag-nl-text: #FB923C; --tag-nl-border: #69412B;
      --tag-pt-bg: #1F2923; --tag-pt-text: #86EFAC; --tag-pt-border: #223B2C;
      --tag-ar-bg: #1F2923; --tag-ar-text: #86EFAC; --tag-ar-border: #223B2C;
      --tag-it-bg: #1E293B; --tag-it-text: #93C5FD; --tag-it-border: #334155;
      --tag-fr-bg: #1E293B; --tag-fr-text: #93C5FD; --tag-fr-border: #334155;
      --tag-es-bg: #451A1A; --tag-es-text: #FCA5A5; --tag-es-border: #622828;
      --tag-et-bg: #1C3141; --tag-et-text: #7DD3FC; --tag-et-border: #2A455A;
    }
    :root {
      --font-main: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; --space-2: 14px; --space-4: 24px;
      --thumb-size: 40px; --track-padding: 3px; --track-width: 88px;
      --thumb-translate: calc(var(--track-width) - var(--thumb-size) - (var(--track-padding) * 2));
    }

    /* 2. MAIN PAGE & SEMANTIC STYLES */
    body { font-family: var(--font-main); line-height: 1.5; background-color: var(--color-bg); color: var(--color-text-primary); margin: 0; padding: var(--space-2); transition: background-color 0.3s ease, color 0.3s ease; }
    .container { max-width: 1400px; margin-left: auto; margin-right: auto; }
    header#controls-section { position: sticky; top: 0; z-index: 20; background: var(--color-bg); padding: 12px 0; margin-bottom: 12px; }
    main .container { background: var(--color-surface); padding: var(--space-4); border-radius: 12px; border: 1px solid var(--color-border); transition: background-color 0.3s ease, border-color 0.3s ease; }
    footer { text-align: center; margin-top: 3rem; font-size: 0.9em; }
    footer p { margin: 0.25rem 0; }
    .visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }

    /* 3. CONTROL ELEMENT STYLES */
    .controls-panel { display: flex; gap: 1em; align-items: center; flex-wrap: wrap; }
    .control-btn { position: relative; background-color: var(--color-surface); border: 1px solid var(--color-border); padding: 0; border-radius: 8px; color: var(--color-text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; height: 48px; width: 48px; flex-shrink: 0; transition: all 0.2s ease; }
    .control-btn:hover { border-color: var(--color-primary); color: var(--color-primary); }
    .control-btn.is-active-filter, #infoBtn.is-active { border-color: var(--color-primary); color: var(--color-primary); background-color: var(--color-primary-a); }
    .control-btn svg { width: 24px; height: 24px; pointer-events: none; }
    #core-cols-toggle-btn .icon-eye-off { display: none; }
    #core-cols-toggle-btn .icon-eye { display: block; }
    #core-cols-toggle-btn[data-state="hidden"] .icon-eye { display: none; }
    #core-cols-toggle-btn[data-state="hidden"] .icon-eye-off { display: block; }

    #searchInput { flex-grow: 1; min-width: 200px; padding: 12px 15px; border-radius: 8px; font-size: 16px; box-sizing: border-box; background-color: var(--color-bg); color: var(--color-text-primary); border: 1px solid var(--color-border); height: 48px; transition: all 0.2s ease; }
    #searchInput:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px var(--color-primary-a); }
    .filter-count { position: absolute; top: -5px; right: -5px; background-color: var(--color-primary); color: var(--color-button-text); border-radius: 50%; width: 20px; height: 20px; font-size: 12px; font-weight: 700; line-height: 20px; text-align: center; pointer-events: none; transform: scale(0); transition: transform 0.2s ease-out; }
    .filter-count:not(:empty) { transform: scale(1); }
    .theme-toggle { display: inline-flex; align-items: center; position: relative; height: 48px; width: var(--track-width); border-radius: 8px; border: 1px solid var(--color-border); background-color: var(--color-surface); cursor: pointer; transition: background-color 0.3s ease; padding: 0; flex-shrink: 0; }
    .theme-toggle:hover { border-color: var(--color-primary); }
    .theme-toggle-thumb { position: absolute; top: var(--track-padding); left: var(--track-padding); height: var(--thumb-size); width: var(--thumb-size); border-radius: 6px; background-color: var(--color-bg); border: 1px solid var(--color-border); display: flex; align-items: center; justify-content: center; transition: transform 0.3s ease, background-color 0.3s ease; transform: translateX(0); color: var(--color-text-primary); }
    .theme-toggle-thumb svg { width: 22px; height: 22px; }
    .theme-toggle .icon-sun { display: none; }
    .theme-toggle .icon-moon { display: block; }
    .theme-toggle[aria-checked="true"] { background-color: var(--color-primary); border-color: var(--color-primary); }
    .theme-toggle[aria-checked="true"] .theme-toggle-thumb { transform: translateX(var(--thumb-translate)); background-color: #FFFFFF; color: var(--color-primary); border-color: transparent; }
    .theme-toggle[aria-checked="true"] .icon-sun { display: block; }
    .theme-toggle[aria-checked="true"] .icon-moon { display: none; }

    .legend-panel { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out, margin 0.3s ease-in-out; background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: 8px; margin-top: 0; padding: 0 16px; }
    .legend-panel:not(.is-hidden) { max-height: 200px; margin-top: 1rem; padding: 12px 16px; }
    .legend-panel h4 { margin: 0 0 8px 0; font-size: 1em; color: var(--color-text-primary); }
    .legend-panel ul { margin: 0; padding: 0 0 0 16px; list-style-type: '¬ª '; columns: 2; }
    .legend-panel li { padding-left: 8px; margin-bottom: 4px; }
    @media (max-width: 600px) { .legend-panel ul { columns: 1; } }

    /* 4. DROPDOWN & ACCORDION STYLES */
    .dropdown-wrapper { position: relative; }
    .dropdown-menu { display: none; position: absolute; top: 110%; right: 0; background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 8px; z-index: 100; min-width: 280px; max-height: 450px; overflow-y: auto; }
    .dropdown-menu.is-open { display: block; }
    #filter-dropdown ul { list-style: none; margin: 0; padding: 0; }
    
    .filter-accordion-item:not(:last-child) { border-bottom: 1px solid var(--color-border); }
    .filter-accordion-header { background: none; border: none; width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 12px 6px; cursor: pointer; text-align: left; }
    .filter-accordion-header h3 { margin: 0; font-size: 1.05em; color: var(--color-text-primary); }
    .filter-accordion-toggle { transition: transform 0.3s ease; color: var(--color-text-secondary); }
    .filter-accordion-toggle svg { width: 20px; height: 20px; }
    .filter-accordion-item.is-open .filter-accordion-toggle { transform: rotate(180deg); color: var(--color-primary); }
    .filter-accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-in-out; }
    .filter-accordion-content .filter-group-list { padding: 4px 6px 12px 6px; }
    .filter-group-list .filter-group-select-all { font-weight: 600; color: var(--color-primary); }
    .filter-group-list .filter-value-item label { display: block; width: 100%; cursor: pointer; padding: 6px 12px; border-radius: 4px; }
    .filter-group-list .filter-value-item:hover { background-color: var(--color-surface-hover); }
    .filter-group-list .filter-value-item input[type="checkbox"] { margin-right: 12px; vertical-align: middle; }
    
    /* 5. TABLE STYLES */
    .table-wrapper { overflow-x: auto; border: 1px solid var(--color-border); border-radius: 8px; margin-top: 1rem; }
    table { border-collapse: collapse; width: 100%; }
    th { font-weight: 600; cursor: pointer; user-select: none; white-space: normal; vertical-align: middle; text-align: center; padding: 8px 6px; border-bottom: 1px solid var(--color-border); }
    td { padding: 10px 12px; text-align: center; vertical-align: middle; border-bottom: 1px solid var(--color-border); }
    thead { position: sticky; top: 0; z-index: 10; background-color: var(--color-surface); color: var(--color-text-primary); }
    th > div { display: flex; align-items: center; justify-content: center; }
    td:not(:last-child) { border-right: 1px solid var(--color-border); }
    th:not(:last-child) { border-right: 1px solid var(--color-border); }
    tbody tr:last-child td { border-bottom: none; }
    .sort-indicator { transition: color 0.2s ease; margin-right: 0.5em; font-size: 1.2em; }
    tbody tr:nth-child(even) { background-color: var(--color-row-even-bg); }
    tbody tr:hover { background-color: var(--color-surface-hover); }
    th.is-active { font-weight: 900; color: var(--color-primary); }
    tbody tr td.is-active { background-color: var(--color-active-col-bg); }
    .is-hidden { display: none !important; }
    
    .currency-tag { display: inline-block; padding: 4px 10px; border-radius: 6px; font-size: 0.9em; font-weight: 700; line-height: 1.2; border: 1px solid transparent; text-align: center; min-width: 50px; transition: background-color 0.3s, color 0.3s, border-color 0.3s; }
    .currency-tag--euro-active { background-color: var(--tag-euro-bg); color: var(--tag-euro-text); border-color: var(--tag-euro-border); }
    .currency-tag--dollar-family { background-color: var(--tag-dollar-bg); color: var(--tag-dollar-text); border-color: var(--tag-dollar-border); }
    .currency-tag--other { background-color: var(--tag-other-bg); color: var(--tag-other-text); border-color: var(--tag-other-border); }
    .currency-tag--note-secondary { background-color: var(--tag-closed-bg); color: var(--tag-closed-text); border-color: var(--tag-closed-border); }
    .currency-tag--eu-national { background-color: var(--tag-eu-bg); color: var(--tag-eu-text); border-color: var(--tag-eu-border); }

    .note-cell-content { display: flex; flex-wrap: wrap; align-items: center; gap: 4px 8px; }
    .note-tag { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; font-weight: 700; line-height: 1.4; white-space: nowrap; }
    .note-tag--closed { background-color: var(--tag-closed-bg); color: var(--tag-closed-text); border: 1px solid var(--tag-closed-border); }
    .note-tag--national { background-color: var(--tag-eu-bg); color: var(--tag-eu-text); border: 1px solid var(--tag-eu-border); }
    .note-tag--external { background-color: var(--tag-dollar-bg); color: var(--tag-dollar-text); border: 1px solid var(--tag-dollar-border); }
    .note-tag--tier { background-color: var(--tag-tier-bg); color: var(--tag-tier-text); border: 1px solid var(--tag-tier-border); }
    .note-tag--nbsp { background-color: var(--tag-nbsp-bg); color: var(--tag-nbsp-text); border: 1px solid var(--tag-nbsp-border); }
    .note-text { font-style: italic; color: var(--color-text-secondary); }

    .text-success { color: var(--color-success); } .text-danger { color: var(--color-danger); } .text-warning { color: var(--color-warning); } .text-unique { color: var(--color-unique); } .text-note-secondary { color: var(--color-text-secondary); }
    
    th:nth-child(1), td:nth-child(1) { width: 8%; text-align: center;}
    td:nth-child(2), td:nth-child(3), td:nth-child(4) { text-align: left; }
    th:nth-child(2) { width: 20%; } th:nth-child(3) { width: 20%; } th:nth-child(4) { width: 25%; white-space: normal;}
    th:nth-child(5), td:nth-child(5) { width: 12%; }
    th:nth-child(6), td:nth-child(6), th:nth-child(7), td:nth-child(7), th:nth-child(8), td:nth-child(8) { width: 1%; text-align: center; white-space: nowrap; }

    /* 6. RESPONSIVENESS - CARD LAYOUT */
    @media (max-width: 820px) {
      .controls-panel { gap: 0.75em; } 
      #searchInput { width: 100%; order: 10; margin-top: 0.5em; }
    
      .table-wrapper { border: none; }
      table, thead, tbody, th, td, tr { display: block; }
      thead tr { position: absolute; top: -9999px; left: -9999px; }
      tbody tr { border: 1px solid var(--color-border); border-radius: 8px; margin-bottom: 1rem; background-color: var(--color-surface); }
      tbody tr:nth-child(even) { background-color: var(--color-surface); }
      td { border: none; border-bottom: 1px solid var(--color-border); position: relative; padding-left: 50%; text-align: right; display: flex; justify-content: flex-end; align-items: center; min-height: 44px; }
      td:last-child { border-bottom: none; }
      td::before { content: attr(data-label); position: absolute; left: 12px; width: 45%; padding-right: 10px; white-space: nowrap; font-weight: 600; text-align: left; color: var(--color-text-secondary); }
      td:nth-child(1) { padding: 12px; font-weight: 700; font-size: 1.1em; background-color: var(--color-row-even-bg); border-radius: 8px 8px 0 0; justify-content: center; }
      td:nth-child(1)::before { display: none; }
    }
  </style>
</head>
<body>

<header id="controls-section">
    <div class="container">
        <div class="controls-panel">
            <button id="scrollToTopBtn" class="control-btn" title="Scroll to top" aria-label="Scroll to top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg></button>
            <button id="theme-switcher" class="theme-toggle" role="switch" title="Switch color theme"> <span class="theme-toggle-thumb"> <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg> <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg> </span> </button>
            <input type="search" id="searchInput" placeholder="Search currency formats...">
            <button id="infoBtn" class="control-btn" title="Show Legend"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></button>
            <button id="core-cols-toggle-btn" class="control-btn" title="Toggle technical columns" aria-label="Toggle technical columns visibility"> <svg class="icon-eye" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg> <svg class="icon-eye-off" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg> </button>
            <button id="showAllBtn" class="control-btn" title="Reset view and show all">
                <span class="filter-count"></span>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3h7v7H3z"/><path d="M14 3h7v7h-7z"/><path d="M14 14h7v7h-7z"/><path d="M3 14h7v7H3z"/></svg>
            </button>
            <div class="dropdown-wrapper">
              <button id="filter-btn" class="control-btn" title="Filter by value" aria-label="Filter table by selected value">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>
              </button>
              <div id="filter-dropdown" class="dropdown-menu"></div>
            </div>
        </div>
        <div id="legend-panel" class="legend-panel is-hidden">
            <h4>Legend</h4>
            <ul>
                <li><strong>Position:</strong> üÖ±Ô∏è - Symbol Before amount</li>
                <li><strong>Decimal:</strong> ‚óè - DOT used as separator</li>
                <li><strong>Thds.:</strong> ‚óè - DOT used as separator</li>
                <li><strong>Thds.:</strong> <span class="text-warning">Nbsp</span> - Space used</li>
                <li><strong>Thds.:</strong> <span class="text-unique">UNQ</span> - Unique sep.</li>
            </ul>
        </div>
    </div> 
</header>

<main>
    <div class="container">
        <div class="table-wrapper">
            <table id="glossaryTable">
                <thead>
                    <tr>
                        <th data-column-index="1" data-column-id="valuta"><div><span class="sort-indicator" aria-hidden="true">‚Üï</span><span>Code</span></div></th>
                        <th data-column-index="2" data-column-id="country"><div><span class="sort-indicator" aria-hidden="true">‚Üï</span><span>Country</span></div></th>
                        <th data-column-index="3" data-column-id="example"><div><span class="sort-indicator" aria-hidden="true">‚Üï</span><span>Example</span></div></th>
                        <th data-column-index="4" data-column-id="note"><div><span class="sort-indicator" aria-hidden="true">‚Üï</span><span>Note</span></div></th>
                        <th data-column-index="5" data-column-id="local" data-is-core="true"><div><span class="sort-indicator" aria-hidden="true">‚Üï</span><span>Local</span></div></th>
                        <th data-column-index="6" data-column-id="symPos" data-is-core="true"><div><span class="sort-indicator" aria-hidden="true">‚Üï</span><span>Position</span></div></th>
                        <th data-column-index="7" data-column-id="decSep" data-is-core="true"><div><span class="sort-indicator" aria-hidden="true">‚Üï</span><span>Decimal</span></div></th>
                        <th data-column-index="8" data-column-id="tdsSep" data-is-core="true"><div><span class="sort-indicator" aria-hidden="true">‚Üï</span><span>Thds.</span></div></th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>
</main>

<footer>
    <p>Generated by MAE OMA-II / UXIFE</p>
    <p style="color: var(--color-primary); font-weight: bold;">¬© 2025 McBile AI-Engine</p>
</footer>

<script>
(() => {
    // --- DATA & CONFIG ---
    let currencyData = [
        {valuta:"EUR",country:"üá¶üá© Andorra (AD)",example:"1.234,56 ‚Ç¨",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"AUD",country:"üá¶üá∫ Australia (AU)",example:"$1,234.56",note:"External: A$",local:"en-AU",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"üá¶üáπ Austria (AT)",example:"1.234,56 ‚Ç¨",note:"",local:"de",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"EUR",country:"üáßüá™ Belgium (BE-FR)",example:"1 234,56 ‚Ç¨",note:"",local:"fr",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"üáßüá™ Belgium (BE-NL)",example:"‚Ç¨ 1.234,56",note:"+ after ‚Ç¨",local:"nl",symPos:"Before",decSep:"COM",tdsSep:"DOT"},
        {valuta:"BRL",country:"üáßüá∑ Brazil (BR)",example:"R$ 1.234,56",note:"",local:"pt-BR",symPos:"Before",decSep:"COM",tdsSep:"DOT"},
        {valuta:"TRY",country:"üáπüá∑ Turkey (TR)",example:"1.234,56 TL",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"BGN",country:"üáßüá¨ Bulgaria (BG)",example:"1 234,56 –ª–≤.",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"CAD",country:"üá®üá¶ Canada (CA-EN)",example:"$1,234.56",note:"External: CA$",local:"en-CA",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"CAD",country:"üá®üá¶ Canada (CA-FR)",example:"$1,234.56",note:"External: CA$",local:"fr-CA",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"üá≠üá∑ Croatia (HR)",example:"1.234,56 ‚Ç¨",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"EUR",country:"üá®üáæ Cyprus (CY)",example:"1.234,56 ‚Ç¨",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"CZK",country:"üá®üáø Czechia (CZ)",example:"1 234,56 Kƒç",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"DKK",country:"üá©üá∞ Denmark (DK)",example:"1.234,56 kr",note:"National DKK",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"EUR",country:"üá™üá™ Estonia (EE)",example:"1 234,56 ‚Ç¨",note:"",local:"et",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"üá´üáÆ Finland (FI)",example:"1 234,56 ‚Ç¨",note:"",local:"fi",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"üá´üá∑ France (FR)",example:"1 234,56 ‚Ç¨",note:"",local:"fr",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"üá©üá™ Germany (DE)",example:"1.234,56 ‚Ç¨",note:"",local:"de",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"USD",country:"üá∫üá∏ GLOBAL (EN)",example:"US$1,234.56",note:"",local:"en",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"üá¨üá∑ Greece (GR)",example:"1.234,56 ‚Ç¨",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"HUF",country:"üá≠üá∫ Hungary (HU)",example:"1 234,56 Ft",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"ISK",country:"üáÆüá∏ Iceland (IS)",example:"1.234,56 kr",note:"National ISK",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"INR",country:"üáÆüá≥ India (IN)",example:"‚Çπ1,23,456.78",note:"",local:"en",symPos:"Before",decSep:"DOT",tdsSep:"UNQ"},
        {valuta:"EUR",country:"üáÆüá™ Ireland (IE)",example:"‚Ç¨1,234.56",note:"",local:"en",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"üáÆüáπ Italy (IT)",example:"1.234,56 ‚Ç¨",note:"",local:"it",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"EUR",country:"üá±üáª Latvia (LV)",example:"1 234,56 ‚Ç¨",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"CHF",country:"üá±üáÆ Liechtenstein (LI)",example:"CHF 1‚Äô234.56",note:"",local:"de",symPos:"Before",decSep:"DOT",tdsSep:"UNQ"},
        {valuta:"EUR",country:"üá±üáπ Lithuania (LT)",example:"1 234,56 ‚Ç¨",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"üá±üá∫ Luxembourg (LU-DE)",example:"1 234,56 ‚Ç¨",note:"",local:"de",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"üá±üá∫ Luxembourg (LU-FR)",example:"1 234,56 ‚Ç¨",note:"",local:"fr",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"üá≤üáπ Malta (MT)",example:"‚Ç¨1,234.56",note:"",local:"en",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"USD",country:"üá∏üá¶ MENA (AR)",example:"US$ Ÿ°Ÿ¨Ÿ¢Ÿ£Ÿ§Ÿ´Ÿ•Ÿ¶",note:"",local:"ar",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"üá≤üá® Monaco (MC)",example:"1 234,56 ‚Ç¨",note:"",local:"fr",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"üá≤üá™ Montenegro (ME)",example:"1.234,56 ‚Ç¨",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"USDT",country:"üåê N/A",example:"1.23456 USDT",note:"",local:"en",symPos:"After",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"üá≥üá± Netherlands (NL)",example:"‚Ç¨ 1.234,56",note:"+ after ‚Ç¨",local:"nl",symPos:"Before",decSep:"COM",tdsSep:"DOT"},
        {valuta:"NZD",country:"üá≥üáø New Zealand (NZ)",example:"$1,234.56",note:"External: NZ$",local:"en-NZ",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"NOK",country:"üá≥üá¥ Norway (NO)",example:"1 234,56 kr",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"PLN",country:"üáµüá± Poland (PL)",example:"1 234,56 z≈Ç",note:"National PLN",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"üáµüáπ Portugal (PT)",example:"1.234,56 ‚Ç¨",note:"",local:"pt-PT",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"RON",country:"üá∑üá¥ Romania (RO)",example:"1.234,56 lei",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"EUR",country:"üá∏üá≤ San Marino (SM)",example:"1.234,56 ‚Ç¨",note:"",local:"it",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"EUR",country:"üá∏üá∞ Slovakia (SK)",example:"1 234,56 ‚Ç¨",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"üá∏üáÆ Slovenia (SI)",example:"1 234,56 ‚Ç¨",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"ZAR",country:"üáøüá¶ South Africa (ZA)",example:"R1,234.56",note:"",local:"en-ZA",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"üá™üá∏ Spain (ES)",example:"1.234,56‚Ç¨",note:"- before ‚Ç¨",local:"es",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"SEK",country:"üá∏üá™ Sweden (SE)",example:"1 234,56 kr",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"CHF",country:"üá®üá≠ Switzerland (CH-DE)",example:"‚Ç¨ 1‚Äô234.56",note:"+ after ‚Ç¨",local:"de",symPos:"Before",decSep:"DOT",tdsSep:"UNQ"},
        {valuta:"CHF",country:"üá®üá≠ Switzerland (CH-FR)",example:"‚Ç¨ 1 234.56",note:"+ after ‚Ç¨",local:"fr",symPos:"Before",decSep:"DOT",tdsSep:"SPC"},
        {valuta:"GBP",country:"üá¨üáß United Kingdom (UK)",example:"¬£1,234.56",note:"",local:"en-UK",symPos:"Before",decSep:"DOT",tdsSep:"COM"}
    ];
    
    // --- CONFIGURATION SETS (SOURCE OF TRUTH) ---
    const TIER_1_CODES = new Set(['AD', 'AU', 'AT', 'BE', 'CA', 'CY', 'DK', 'EE', 'FI', 'FR', 'DE', 'IS', 'IE', 'IT', 'LI', 'LU', 'MT', 'NL', 'NZ', 'NO', 'SM', 'SI', 'ES', 'SE', 'CH', 'UK', 'MC', 'AR']);
    const TIER_2_CODES = new Set(['BG', 'CZ', 'GR', 'HU', 'LV', 'LT', 'ME', 'PL', 'PT', 'RO', 'SK', 'HR']);
    const TIER_3_CODES = new Set(['BR', 'IN', 'ZA', 'TR']);
    const CLOSED_CODES = new Set(['AD', 'BR', 'TR', 'BG', 'HR', 'CY', 'CZ', 'GR', 'HU', 'LV', 'LI', 'LT', 'MC', 'ME', 'RO', 'SM', 'SK', 'SE']);
    const NATIONAL_EUR_MAP = new Map([['CZ','CZK'],['HU','HUF'],['NO','NOK'],['SE','SEK'],['RO','RON'],['BG','BGN'],['LI','CHF'],['CH','CHF'],['PL','PLN'],['IS','ISK'],['DK','DKK'],['UK','GBP']]);
    const EXTERNAL_MAP = new Map([['AU','A$'],['CA','CA$'],['NZ','NZ$'],['US','US$']]);
    const DOLLAR_FAMILY = new Set(['AUD', 'CAD', 'NZD', 'USD', 'USDT']);
    
    // --- DATA TRANSFORMATION ---
    const getCountryCode = (countryString) => { const match = countryString.match(/\((\w{2,3}(?:-\w{2})?)\)/); return match ? match[1].split('-')[0] : null; };
    
    currencyData.forEach(item => {
        item.countryCode = getCountryCode(item.country);
        item.displayCode = item.valuta;

        if (NATIONAL_EUR_MAP.has(item.countryCode)) {
            item.valuta = "EUR";
            item.displayCode = NATIONAL_EUR_MAP.get(item.countryCode);
        }
    });
    currencyData.forEach(item => {
        if (NATIONAL_EUR_MAP.has(item.countryCode)) {
            const tds = item.tdsSep === 'SPC' ? ' ' : (item.tdsSep === 'DOT' ? '.' : (item.tdsSep === 'UNQ' ? '‚Äô' : ','));
            const dec = item.decSep === 'COM' ? ',' : '.';
            const baseNumber = `1${tds}234${dec}56`;
            if (item.symPos === 'Before') { item.example = `‚Ç¨${baseNumber}`; } else { item.example = `${baseNumber} ‚Ç¨`; }
        }
    });

    // --- NOTE INFO PARSER ---
    currencyData.forEach(item => {
        item.noteInfo = { tags: [], text: '' };
        if (["Tether (USDT)", "GLOBAL (EN)", "MENA (AR)"].some(name => item.country.includes(name))) return;
        
        let processingNote = item.note || '';

        if (TIER_1_CODES.has(item.countryCode)) item.noteInfo.tags.push({ type: 'tier', label: 'Tier 1' });
        else if (TIER_2_CODES.has(item.countryCode)) item.noteInfo.tags.push({ type: 'tier', label: 'Tier 2' });
        else if (TIER_3_CODES.has(item.countryCode)) item.noteInfo.tags.push({ type: 'tier', label: 'Tier 3' });
        
        if (CLOSED_CODES.has(item.countryCode)) item.noteInfo.tags.push({ type: 'closed', label: 'closed' });
        if (NATIONAL_EUR_MAP.has(item.countryCode)) item.noteInfo.tags.push({ type: 'national', label: 'national' });
        if (EXTERNAL_MAP.has(item.countryCode)) {
            item.noteInfo.tags.push({ type: 'external', label: 'external' });
            item.noteInfo.text = EXTERNAL_MAP.get(item.countryCode);
        }
        
        if (processingNote.includes("+ after ‚Ç¨")) item.noteInfo.tags.push({ type: 'nbsp', label: '+ after' });
        if (processingNote.includes("- before ‚Ç¨")) item.noteInfo.tags.push({ type: 'nbsp', label: '- before' });
    });
    
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM ELEMENT REFERENCES ---
        const D = document;
        const htmlElement = D.documentElement;
        const table = D.getElementById('glossaryTable');
        if (!table) return;

        const scrollToTopBtn = D.getElementById('scrollToTopBtn');
        const coreColsToggleBtn = D.getElementById('core-cols-toggle-btn');
        const filterBtn = D.getElementById('filter-btn');
        const searchInput = D.getElementById('searchInput');
        const themeSwitcher = D.getElementById('theme-switcher');
        const showAllBtn = D.getElementById('showAllBtn');
        const infoBtn = D.getElementById('infoBtn');
        const legendPanel = D.getElementById('legend-panel');
        const filterDropdown = D.getElementById('filter-dropdown');
        const tableBody = D.getElementById('tableBody');
        const headers = Array.from(table.querySelectorAll('thead th'));

        // --- STATE MANAGEMENT ---
        let tableConfig = {};
        let activeFilters = {};
        let sortState = {};
        let showClosed = false;
        let coreMasterToggle = true;
        let columnVisibility = {};

        // --- LOCALSTORAGE & HELPERS ---
        const getFromStorage = (key, defaultValue) => { try { const value = localStorage.getItem(key); return value ? JSON.parse(value) : defaultValue; } catch (e) { return defaultValue; } };
        const saveToStorage = (key, value) => localStorage.setItem(key, JSON.stringify(value));
        const getValutaCategory = (item) => {
            if (item.valuta === 'EUR' && !NATIONAL_EUR_MAP.has(item.countryCode)) return 0;
            if (NATIONAL_EUR_MAP.has(item.countryCode)) return 1;
            if (DOLLAR_FAMILY.has(item.valuta)) return 2;
            if (CLOSED_CODES.has(item.countryCode)) return 4;
            return 3;
        };

        // --- RENDER & VIEW LOGIC ---
        const renderNoteCell = (noteInfo) => {
            if (!noteInfo || (!noteInfo.tags.length && !noteInfo.text)) return '';
            let tagsHtml = noteInfo.tags.map(tag => `<span class="note-tag note-tag--${tag.type}">${tag.label}</span>`).join('');
            let textHtml = noteInfo.text ? `<span class="note-text">${noteInfo.text}</span>` : '';
            return `<div class="note-cell-content">${tagsHtml}${textHtml}</div>`;
        };
        const renderLocaleCell = (localeString) => {
            const parts = localeString.split('-');
            const lang = parts[0];
            const region = parts[1] || '';
            const langTagColor = `var(--tag-${lang}-bg, var(--tag-other-bg))`;
            const langTextColor = `var(--tag-${lang}-text, var(--tag-other-text))`;
            const langBorderColor = `var(--tag-${lang}-border, var(--tag-other-border))`;
            return `<div class="note-cell-content"><span class="note-tag" style="background-color:${langTagColor}; color:${langTextColor}; border-color:${langBorderColor};">${lang}</span> ${region ? `<span class="note-text">${region}</span>` : ''}</div>`;
        };
        const getBaseStyling = (item) => {
            const classes = { country: '', example: '', valutaTag: '', valutaText: item.displayCode };
            if (NATIONAL_EUR_MAP.has(item.countryCode)) {
                classes.valutaTag = 'currency-tag--eu-national';
            } else {
                if (CLOSED_CODES.has(item.countryCode)) {
                    classes.country = 'text-note-secondary';
                    classes.example = 'text-note-secondary';
                    classes.valutaTag = 'currency-tag--note-secondary';
                } else {
                    const category = getValutaCategory(item);
                    if (category === 0) { classes.valutaTag = 'currency-tag--euro-active'; } 
                    else if (category === 2) { classes.valutaTag = 'currency-tag--dollar-family'; } 
                    else { classes.valutaTag = 'currency-tag--other'; }
                }
            }
            const tempCountry = item.country.replace(/(-FR|-NL|-EN|-DE)/g, '<span class="text-warning">$1</span>');
            const tempExample = item.example.replace(/^(‚Ç¨|CHF)/, '<span class="text-warning">$1</span>');
            return { classes, tempCountry, tempExample };
        };
        const renderTable = (data) => {
            let html = '';
            if (data.length === 0) {
                html = `<tr><td colspan="${headers.length}" style="text-align: center; padding: 2rem; color: var(--color-text-secondary);">No records match your criteria.</td></tr>`;
            } else {
                data.forEach(item => {
                    const { classes, tempCountry, tempExample } = getBaseStyling(item);
                    const noteHtml = renderNoteCell(item.noteInfo);
                    const localeHtml = renderLocaleCell(item.local);
                    let symPosHtml = '<span></span>'; if (item.symPos === 'Before') symPosHtml = `<span class="text-danger">üÖ±Ô∏è</span>`;
                    let decSepHtml = '<span></span>'; if (item.decSep === 'DOT') decSepHtml = `<span class="text-danger">‚óè</span>`;
                    let tdsSepHtml = '<span></span>';
                    switch(item.tdsSep) { case 'SPC': tdsSepHtml = `<span class="text-warning">Nbsp</span>`; break; case 'UNQ': tdsSepHtml = `<span class="text-unique">UNQ</span>`; break; case 'DOT': tdsSepHtml = `<span class="text-success">‚óè</span>`; break; }
                    html += `<tr>
                        <td data-label="${tableConfig.indexToLabel[1]}"><span class="currency-tag ${classes.valutaTag}">${classes.valutaText}</span></td>
                        <td data-label="${tableConfig.indexToLabel[2]}"><span class="${classes.country}">${tempCountry}</span></td>
                        <td data-label="${tableConfig.indexToLabel[3]}"><span class="${classes.example}">${tempExample}</span></td>
                        <td data-label="${tableConfig.indexToLabel[4]}" data-column-id="note">${noteHtml}</td>
                        <td data-label="${tableConfig.indexToLabel[5]}" data-column-id="local">${localeHtml}</td><td data-label="${tableConfig.indexToLabel[6]}" data-column-id="symPos">${symPosHtml}</td>
                        <td data-label="${tableConfig.indexToLabel[7]}" data-column-id="decSep">${decSepHtml}</td><td data-label="${tableConfig.indexToLabel[8]}" data-column-id="tdsSep">${tdsSepHtml}</td></tr>`;
                });
            }
            tableBody.innerHTML = html;
        };
        const updateView = () => {
            const searchQuery = searchInput.value.toLowerCase().trim();
            let dataToProcess = showClosed ? currencyData : currencyData.filter(item => !CLOSED_CODES.has(item.countryCode));
            
            let filteredData = dataToProcess.filter(item => {
                const searchHaystack = [Object.values(item).join(' '), item.originalNote || ''].join(' ').toLowerCase();
                if (searchQuery && !searchHaystack.includes(searchQuery)) return false;
                
                for (const group in activeFilters) {
                    const hiddenValues = activeFilters[group];
                    if (hiddenValues.size > 0) {
                        let itemValue;
                        if (group === 'codeTag') {
                            const cat = getValutaCategory(item);
                            if(NATIONAL_EUR_MAP.has(item.countryCode)) itemValue = "National";
                            else if(cat === 0) itemValue = "‚Ç¨";
                            else if(cat === 2) itemValue = "$ Family";
                            else itemValue = "Other";
                        } else if (group === 'noteTag') {
                            const itemTags = new Set(item.noteInfo.tags.map(t => t.type === 'nbsp' ? 'nbsp' : t.label));
                            if ([...hiddenValues].some(hiddenTag => itemTags.has(hiddenTag))) return false;
                            continue;
                        } else if (group === 'currencyName') {
                            itemValue = item.displayCode;
                        } else if (group === 'country') {
                            itemValue = item.country.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]\s*/g, '').trim();
                        } else { // locale
                            itemValue = item.local;
                        }
                        if (hiddenValues.has(itemValue)) return false;
                    }
                }
                return true;
            });
            
            const { columnId, direction } = sortState;
            if (columnId) {
                filteredData.sort((a, b) => {
                    if (columnId === 'valuta') { const catA = getValutaCategory(a), catB = getValutaCategory(b); if (catA !== catB) return direction === 'asc' ? catA - catB : catB - catA; }
                    const valA = a[columnId] || ''; const valB = b[columnId] || '';
                    const compareResult = valA.localeCompare(valB, 'en', {numeric: true});
                    return direction === 'asc' ? compareResult : -compareResult;
                });
            }
            renderTable(filteredData);
            updateGlobalStateIndicator();
        };

        // --- UI STATE UPDATERS ---
        const updateGlobalStateIndicator = () => {
            let count = 0;
            Object.values(activeFilters).forEach(filterSet => count += filterSet.size);
            count += Object.values(columnVisibility).filter(v => !v).length;
            if (!coreMasterToggle) count += 1;
            if(!showClosed && currencyData.some(i => CLOSED_CODES.has(i.countryCode))) count += 1; 

            const counter = showAllBtn.querySelector('.filter-count');
            counter.textContent = count > 0 ? count : '';
            showAllBtn.classList.toggle('is-active-filter', count > 0);
            updateSortHeaders();
        };
        const applyColumnVisibility = () => {
            let style = D.getElementById('column-visibility-styles');
            if(!style) { style = D.createElement('style'); style.id = 'column-visibility-styles'; D.head.appendChild(style); }
            const cssRules = [];
            coreColsToggleBtn.dataset.state = coreMasterToggle ? 'hidden' : 'visible'; // Corrected logic

            Object.entries(columnVisibility).forEach(([colId, isVisible]) => {
                const index = tableConfig.columnIdToIndex[colId];
                if (index) {
                    const displayRule = (coreMasterToggle && isVisible) ? '' : 'display: none !important;';
                    cssRules.push(`th[data-column-index="${index}"], td[data-column-id="${colId}"] { ${displayRule} }`);
                }
            });
            style.textContent = cssRules.join(' ');
            const colToggleSection = filterDropdown.querySelector('#col-toggle-section');
            if(colToggleSection) {
                colToggleSection.querySelectorAll('.col-toggle-btn').forEach(btn => {
                    const col = btn.dataset.col;
                    const isActive = col === 'separators' ? (columnVisibility.decSep && columnVisibility.tdsSep) : columnVisibility[col];
                    btn.classList.toggle('is-active', isActive);
                });
            }
            updateGlobalStateIndicator();
        };
        const updateSortHeaders = () => {
            headers.forEach(h => { h.classList.remove('is-active'); h.removeAttribute('aria-sort'); h.querySelector('.sort-indicator').textContent = '‚Üï'; });
            const activeHeader = headers[tableConfig.columnIdToIndex[sortState.columnId] - 1];
            if(activeHeader){
                activeHeader.classList.add('is-active');
                activeHeader.setAttribute('aria-sort', sortState.direction === 'asc' ? 'ascending' : 'descending');
                activeHeader.querySelector('.sort-indicator').textContent = sortState.direction === 'asc' ? '‚ñ≤' : '‚ñº';
            }
        };

        const populateFilterDropdown = () => {
            const filters = {
                codeTag: { title: 'Code Tag', values: new Set() },
                noteTag: { title: 'Note Tag', values: new Set() },
                currencyName: { title: 'Currency Name', values: new Set() },
                country: { title: 'Country', values: new Set() },
                locale: { title: 'Locale', values: new Set() }
            };

            currencyData.forEach(item => {
                const cat = getValutaCategory(item);
                if(NATIONAL_EUR_MAP.has(item.countryCode)) filters.codeTag.values.add("National");
                else if(cat === 0) filters.codeTag.values.add("‚Ç¨");
                else if(cat === 2) filters.codeTag.values.add("$ Family");
                else filters.codeTag.values.add("Other");

                item.noteInfo.tags.forEach(tag => filters.noteTag.values.add(tag.type === 'nbsp' ? 'nbsp' : tag.label));

                filters.currencyName.values.add(item.displayCode);
                filters.country.values.add(item.country.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]\s*/g, '').trim());
                filters.locale.values.add(item.local);
            });
            
            let html = ``;
            Object.entries(filters).forEach(([key, config]) => {
                const allValues = [...config.values].sort((a,b) => a.localeCompare(b, 'en'));
                const isAllSelected = !activeFilters[key] || activeFilters[key].size === 0;

                let listItems = `<li class="filter-value-item filter-group-select-all"><label><input type="checkbox" data-group="${key}" data-action="select-all" ${isAllSelected ? 'checked' : ''}> Select All</label></li>`;
                listItems += allValues.map(val => `
                    <li class="filter-value-item">
                        <label><input type="checkbox" data-group="${key}" data-value="${val}" ${!activeFilters[key] || !activeFilters[key].has(val) ? 'checked' : ''}> ${val}</label>
                    </li>`).join('');

                html += `<li class="filter-accordion-item">
                    <button class="filter-accordion-header"><h3>${config.title}</h3><span class="filter-accordion-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></span></button>
                    <div class="filter-accordion-content"><ul class="filter-group-list" data-group-id="${key}">${listItems}</ul></div>
                </li>`;
            });

            filterDropdown.innerHTML = `<ul id="filter-list">${html}</ul>`;
        };
        
        const init = () => {
            const columnIdToIndex = {}; const indexToLabel = {};
            headers.forEach((th, i) => { const index = i + 1; const id = th.dataset.columnId; if (!id) return; columnIdToIndex[id] = index; indexToLabel[index] = th.innerText.replace(/\n/g, ' '); });
            tableConfig = { headers, columnIdToIndex, indexToLabel, defaultSortState: { columnId: 'valuta', direction: 'asc' } };
            
            const storedFilters = getFromStorage('activeFilters', {});
            activeFilters = Object.fromEntries(Object.entries(storedFilters).map(([k, v]) => [k, new Set(v)]));
            sortState = getFromStorage('sortState', tableConfig.defaultSortState);
            showClosed = getFromStorage('showClosedState', false);
            const savedTheme = getFromStorage('theme', 'dark'); htmlElement.setAttribute('data-theme', savedTheme); themeSwitcher.setAttribute('aria-checked', savedTheme === 'light' ? 'true' : 'false');
            
            const initialCoreMasterState = getFromStorage('coreMasterToggle', null);
            coreMasterToggle = initialCoreMasterState === null ? (window.innerWidth >= 820) : initialCoreMasterState;
            columnVisibility = getFromStorage('columnVisibility', { local: true, symPos: true, decSep: true, tdsSep: true });
            applyColumnVisibility();

            // --- EVENT LISTENERS ---
            scrollToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
            themeSwitcher.addEventListener('click', () => { const newTheme = themeSwitcher.getAttribute('aria-checked') === 'true' ? 'dark' : 'light'; htmlElement.setAttribute('data-theme', newTheme); themeSwitcher.setAttribute('aria-checked', newTheme === 'light' ? 'true' : 'false'); saveToStorage('theme', newTheme); });
            showAllBtn.addEventListener('click', () => {
                searchInput.value = '';
                activeFilters = {};
                showClosed = true;
                sortState = { ...tableConfig.defaultSortState };
                coreMasterToggle = true;
                columnVisibility = { local: true, symPos: true, decSep: true, tdsSep: true };
                saveToStorage('showClosedState', true);
                saveToStorage('activeFilters', {});
                saveToStorage('sortState', sortState);
                saveToStorage('coreMasterToggle', true);
                saveToStorage('columnVisibility', columnVisibility);
                applyColumnVisibility();
                updateView();
                populateFilterDropdown();
            });
            infoBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                legendPanel.classList.toggle('is-hidden');
                infoBtn.classList.toggle('is-active');
            });
            headers.forEach(header => header.addEventListener('click', () => { const colId = header.dataset.columnId; if (!colId) return; sortState.direction = (sortState.columnId === colId && sortState.direction === 'asc') ? 'desc' : 'asc'; sortState.columnId = colId; saveToStorage('sortState', sortState); updateView(); }));
            searchInput.addEventListener('input', () => { showClosed = getFromStorage('showClosedState', false); updateView(); });
            D.addEventListener('click', (e) => { 
                if (!filterDropdown.contains(e.target) && !filterBtn.contains(e.target)) filterDropdown.classList.remove('is-open');
                if (!legendPanel.contains(e.target) && !infoBtn.contains(e.target)) {
                    legendPanel.classList.add('is-hidden');
                    infoBtn.classList.remove('is-active');
                }
            });
            
            filterBtn.addEventListener('click', (e) => { e.stopPropagation(); if (!filterDropdown.classList.contains('is-open')) { populateFilterDropdown(); } filterDropdown.classList.toggle('is-open'); });
            
            filterDropdown.addEventListener('click', e => {
                const header = e.target.closest('.filter-accordion-header');
                if (header) { const item = header.parentElement; item.classList.toggle('is-open'); header.nextElementSibling.style.maxHeight = item.classList.contains('is-open') ? header.nextElementSibling.scrollHeight + 'px' : '0px'; return; }

                const checkbox = e.target.closest('input[type="checkbox"]');
                if (checkbox) {
                    const { group, value, action } = checkbox.dataset;
                    if (!activeFilters[group]) activeFilters[group] = new Set();
                    const list = checkbox.closest('.filter-group-list');
                    
                    if (action === 'select-all') {
                        if (checkbox.checked) {
                            activeFilters[group].clear();
                            list.querySelectorAll('input[data-value]').forEach(cb => cb.checked = true);
                        } else {
                            list.querySelectorAll('input[data-value]').forEach(cb => {
                                activeFilters[group].add(cb.dataset.value);
                                cb.checked = false;
                            });
                        }
                    } else {
                        if (checkbox.checked) {
                            activeFilters[group].delete(value);
                        } else {
                            activeFilters[group].add(value);
                        }
                        const allCheckboxes = list.querySelectorAll('input[data-value]');
                        const allSelectedCheckbox = list.querySelector('input[data-action="select-all"]');
                        allSelectedCheckbox.checked = ![...allCheckboxes].some(cb => !cb.checked);
                    }
                    saveToStorage('activeFilters', Object.fromEntries(Object.entries(activeFilters).map(([k, v]) => [k, [...v]])));
                    updateView();
                }
            });
            
            coreColsToggleBtn.addEventListener('click', () => { coreMasterToggle = !coreMasterToggle; saveToStorage('coreMasterToggle', coreMasterToggle); applyColumnVisibility(); });
            
            // --- INITIAL RENDER ---
            updateView();
        };
        init();
    });
})();
</script>

</body>
</html>
