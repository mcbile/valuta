
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Valuta Formats</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    /* CSS: 1. VARIABLES AND BASE STYLES */
    :root {
      /* Light Theme */
      --color-bg: #F9FAFB; --color-surface: #FFFFFF; --color-surface-hover: rgba(59, 130, 246, 0.1); --color-primary: #3B82F6; --color-primary-a: 
        rgba(59, 130, 246, 0.15); --color-button-text: #FFFFFF; --color-text-primary: #1F2937; --color-text-secondary: #6B7280; --color-border: #E5E7EB;
      --color-success: #16A34A;
      --color-danger: #EF4444;
      --color-warning: #F59E0B;
      --color-unique: #8E24AA;
      --color-active-col-bg: rgba(59, 130, 246, 0.1);
      --color-row-even-bg: #F3F4F6;
      --color-tag-active-shadow: rgba(59, 130, 246, 0.6);

      /* Muted Tag Colors (Light Theme) */
      --tag-success-bg: #F0FDF4; --tag-success-text: #15803D; --tag-success-border: #BBF7D0;
      --tag-danger-bg: #FEF2F2; --tag-danger-text: #EF959E; --tag-danger-border: #FECACA;
      --tag-warning-bg: #FFFBEB; --tag-warning-text: #B45309; --tag-warning-border: #FCD34D;
      --tag-euro-active-bg: #E0F2FE; --tag-euro-active-text: #0C4A6E; --tag-euro-active-border: #BAE6FD;
      --tag-dollar-bg: #F0FDF4; --tag-dollar-text: #166534; --tag-dollar-border: #BBF7D0;
      --tag-other-bg: #F3E5F5; --tag-other-text: #8E24AA; --tag-other-border: #E1BEE7;
      --tag-closed-bg: #F3F4F6; --tag-closed-text: #374151; --tag-closed-border: #E5E7EB;
      --tag-national-bg: #FEFCE8; --tag-national-text: #A16207; --tag-national-border: #FDE047;
      --tag-region-bg: var(--tag-national-bg); --tag-region-text: var(--tag-national-text); --tag-region-border: var(--tag-national-border);
      --tag-nbsp-bg: #FFF7ED; --tag-nbsp-text: #9A3412; --tag-nbsp-border: #FED7AA;
      --tag-unique-bg: #F3E5F5; --tag-unique-text: #8E24AA; --tag-unique-border: #E1BEE7;
      
      --tag-tier-1-bg: #DCFCE7; --tag-tier-1-text: #15803D; --tag-tier-1-border: #86EFAC;
      --tag-tier-2-bg: #FEF9C3; --tag-tier-2-text: #854D0E; --tag-tier-2-border: #FDE047;
      --tag-de-bg: #FDF2F8; --tag-de-text: #9D2667; --tag-de-border: #FBCFE8;
      --tag-tier-3-bg: var(--tag-de-bg); --tag-tier-3-text: var(--tag-de-text); --tag-tier-3-border: var(--tag-de-border);
      
      --tag-en-bg: #F3F4F6; --tag-en-text: #374151; --tag-en-border: #E5E7EB;
      --tag-nl-bg: #FFF7ED; --tag-nl-text: #9A3412; --tag-nl-border: #FED7AA;
      --tag-pt-bg: #F0FDF4; --tag-pt-text: #166534; --tag-pt-border: #BBF7D0;
      --tag-ar-bg: #F0FDF4; --tag-ar-text: #166534; --tag-ar-border: #BBF7D0;
      --tag-it-bg: #EFF6FF; --tag-it-text: #1E40AF; --tag-it-border: #BFDBFE;
      --tag-fr-bg: #EFF6FF; --tag-fr-text: #1E40AF; --tag-fr-border: #BFDBFE;
      --tag-es-bg: #FEF2F2; --tag-es-text: #991B1B; --tag-es-border: #FECACA;
      --tag-et-bg: #F0F9FF; --tag-et-text: #0C4A6E; --tag-et-border: #BAE6FD;
    }
    [data-theme="dark"] {
      /* Dark Theme */
      --color-bg: #111827; --color-surface: #151D2F; --color-surface-hover: #1E2840; --color-primary: #00BCD4; --color-primary-a: 
        rgba(96, 165, 250, 0.15); --color-button-text: #111827; --color-text-primary: #E9FAFA; --color-text-secondary: #B0BEC5; --color-border: #374151;
      --color-success: #4ADE80;
      --color-danger: #BBF7D0;
      --color-warning: #FBBF24;
      --color-unique: #CE93D8;
      --color-active-col-bg: rgba(96, 165, 250, 0.1);
      --color-row-even-bg: var(--color-bg);
      --color-tag-active-shadow: rgba(0, 188, 212, 0.7);

      /* Muted Tag Colors (Dark Theme) */
      --tag-success-bg: #163422; --tag-success-text: #4ADE80; --tag-success-border: #235538;
      --tag-danger-bg: #783036; --tag-danger-text: #e7ccce; --tag-danger-border: #622828;
      --tag-warning-bg: #42300A; --tag-warning-text: #FBBF24; --tag-warning-border: #694D12;
      --tag-euro-active-bg: #1E3A8A; --tag-euro-active-text: #BFDBFE; --tag-euro-active-border: #3B82F6;
      --tag-dollar-bg: #1F2923; --tag-dollar-text: #86EFAC; --tag-dollar-border: #223B2C;
      --tag-other-bg: #321B38; --tag-other-text: #CE93D8; --tag-other-border: #4A2A53;
      --tag-closed-bg: #374151; --tag-closed-text: #D1D5DB; --tag-closed-border: #4B5563;
      --tag-national-bg: #332C1B; --tag-national-text: #FDE047; --tag-national-border: #564826;
      --tag-region-bg: var(--tag-unique-bg); --tag-region-text: #FFDDEE; --tag-region-border: var(--tag-unique-border);
      --tag-nbsp-bg: #3F271A; --tag-nbsp-text: #FB923C; --tag-nbsp-border: #69412B;
      --tag-unique-bg: #321B38; --tag-unique-text: #CE93D8; --tag-unique-border: #4A2A53;

      --tag-tier-1-bg: #163422; --tag-tier-1-text: #4ADE80; --tag-tier-1-border: #235538;
      --tag-tier-2-bg: #42300A; --tag-tier-2-text: #FBBF24; --tag-tier-2-border: #694D12;
      --tag-tier-3-bg: #401A29; --tag-tier-3-text: #e7ccce; --tag-tier-3-border: #572A3F;

    /*--tag-XX-bg: #AA5555; --tag-XX-text: #451A1A; --tag-XX-border: #F87171; */
      
      --tag-ar-bg: #16A34A; --tag-ar-text: #DDDDDD; --tag-ar-border: #86EFAC;
      --tag-es-bg: #401A29; --tag-es-text: #F9A8D4; --tag-es-border: #572A3F;
      --tag-en-bg: #374151; --tag-en-text: #D1D5DB; --tag-en-border: #4B5563;
      --tag-nl-bg: #3F271A; --tag-nl-text: #FB923C; --tag-nl-border: #69412B;
      --tag-pt-bg: #1F2923; --tag-pt-text: #86EFAC; --tag-pt-border: #223B2C;
      --tag-it-bg: #1E293B; --tag-it-text: #93C5FD; --tag-it-border: #334155;
      --tag-fr-bg: #1E3A8A; --tag-fr-text: #BFDBFE; --tag-fr-border: #3B82F6;
      --tag-de-bg: #000000; --tag-de-text: #FFC488; --tag-de-border: #800000;
      --tag-et-bg: #1C3141; --tag-et-text: #7DD3FC; --tag-et-border: #2A455A;
    }
    :root {
      --font-main: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; --space-2: 14px; --space-4: 24px;
    }

    /* CSS: 2. MAIN PAGE & SEMANTIC STYLES */
    body { font-family: var(--font-main); line-height: 1.5; background-color: var(--color-bg); color: var(--color-text-primary); margin: 0; padding: var(--space-2); transition: background-color 0.3s ease, color 0.3s ease; }
    .container { max-width: 1400px; margin-left: auto; margin-right: auto; }
    header#controls-section { position: sticky; top: 0; z-index: 20; background: var(--color-bg); padding: 12px 0; margin-bottom: 12px; }
    main .container { background: var(--color-surface); padding: var(--space-4); border-radius: 12px; border: 1px solid var(--color-border); transition: background-color 0.3s ease, border-color 0.3s ease; }
    footer { text-align: center; margin-top: 3rem; font-size: 0.9em; }
    footer p { margin: 0.25rem 0; }
    .visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }

    /* CSS: 3. CONTROL ELEMENT STYLES */
    .controls-panel { display: flex; gap: 1em; align-items: center; flex-wrap: wrap; }
    .control-btn { position: relative; background-color: var(--color-surface); border: 1px solid var(--color-border); padding: 0; border-radius: 8px; color: var(--color-text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; height: 48px; width: 48px; flex-shrink: 0; transition: all 0.2s ease; }
    .control-btn:hover { border-color: var(--color-primary); color: var(--color-primary); }
    .control-btn.is-active-filter, #infoBtn.is-active { border-color: var(--color-primary); color: var(--color-primary); background-color: var(--color-primary-a); }
    .control-btn svg { width: 24px; height: 24px; pointer-events: none; }

    #core-cols-toggle-btn .icon-eye-off { display: none; }
    #core-cols-toggle-btn .icon-eye { display: block; }
    #core-cols-toggle-btn[data-state="hidden"] .icon-eye { display: none; }
    #core-cols-toggle-btn[data-state="hidden"] .icon-eye-off { display: block; }
    
    #theme-switcher .icon-sun { display: none; }
    #theme-switcher .icon-moon { display: block; }
    [data-theme="light"] #theme-switcher .icon-sun { display: block; }
    [data-theme="light"] #theme-switcher .icon-moon { display: none; }
    
    #scrollToTopBtn { position: fixed; bottom: 20px; right: 20px; z-index: 1000; opacity: 0; visibility: hidden; transform: translateY(20px); transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease; }
    #scrollToTopBtn.is-visible { opacity: 1; visibility: visible; transform: translateY(0); }
    
    #searchInput { flex-grow: 1; min-width: 200px; padding: 12px 15px; border-radius: 8px; font-size: 16px; box-sizing: border-box; background-color: var(--color-bg); color: var(--color-text-primary); border: 1px solid var(--color-border); height: 48px; transition: all 0.2s ease; }
    #searchInput:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px var(--color-primary-a); }
    .filter-count { position: absolute; top: -5px; right: -5px; background-color: var(--color-primary); color: var(--color-button-text); border-radius: 50%; width: 20px; height: 20px; font-size: 12px; font-weight: 700; line-height: 20px; text-align: center; pointer-events: none; transform: scale(0); transition: transform 0.2s ease-out; }
    .filter-count:not(:empty) { transform: scale(1); }

    .legend-panel { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out, margin 0.5s ease-in-out; background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: 8px; margin-top: 0; padding: 0 16px; }
    .legend-panel:not(.is-hidden) { max-height: 800px; margin-top: 1rem; padding: 16px; }
    
    /* CSS: 4. DROPDOWN & ACCORDION STYLES */
    .dropdown-wrapper { position: relative; }
    .dropdown-menu { display: none; position: absolute; top: 110%; right: 0; background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 8px; z-index: 100; min-width: 280px; max-height: 450px; overflow-y: auto; }
    .dropdown-menu.is-open { display: block; }
    #filter-dropdown ul { list-style: none; margin: 0; padding: 0; }
    
    .filter-accordion-item:not(:last-child) { border-bottom: 1px solid var(--color-border); }
    .filter-accordion-header { background: none; border: none; width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 12px 6px; cursor: pointer; text-align: left; }
    .filter-accordion-header h3 { margin: 0; font-size: 1.05em; color: var(--color-text-primary); }
    .filter-accordion-toggle { transition: transform 0.3s ease; color: var(--color-text-secondary); }
    .filter-accordion-toggle svg { width: 20px; height: 20px; }
    .filter-accordion-item.is-open .filter-accordion-toggle { transform: rotate(180deg); color: var(--color-primary); }
    .filter-accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-in-out; }
    .filter-accordion-content .filter-group-list { padding: 4px 6px 12px 6px; }
    .filter-group-list .filter-group-select-all { font-weight: 600; color: var(--color-primary); }
    .filter-group-list .filter-value-item label { display: block; width: 100%; cursor: pointer; padding: 6px 12px; border-radius: 4px; }
    .filter-group-list .filter-value-item:hover { background-color: var(--color-surface-hover); }
    .filter-group-list .filter-value-item input[type="checkbox"] { margin-right: 12px; vertical-align: middle; }
    
    /* CSS: 4.5. LEGEND STYLES */
    .legend-grid { display: flex; gap: 2rem; flex-wrap: wrap; }
    .legend-column { flex: 1; min-width: 300px; }
    .legend-column h4 { font-size: 1.1em; margin: 0 0 1em 0; border-bottom: 1px solid var(--color-border); padding-bottom: 0.5em; }
    .legend-item { display: flex; align-items: flex-start; margin-bottom: 0.8em; }
    .legend-item__key { flex-shrink: 0; margin-right: 12px; display: flex; flex-wrap: wrap; gap: 4px; align-items: center; min-width: 140px; }
    .legend-item__desc { font-size: 0.9em; color: var(--color-text-secondary); line-height: 1.6; }
    .legend-item__key .note-tag { padding-top: 3px; padding-bottom: 3px; }

    /* CSS: 5. TABLE STYLES */
    .table-wrapper { overflow-x: auto; border: 1px solid var(--color-border); border-radius: 8px; margin-top: 1rem; }
    table { border-collapse: collapse; width: 100%; }
    th { font-weight: 600; cursor: pointer; user-select: none; white-space: normal; vertical-align: middle; text-align: center; padding: 8px 6px; border-bottom: 1px solid var(--color-border); }
    td { padding: 10px 12px; text-align: center; vertical-align: middle; border-bottom: 1px solid var(--color-border); }
    thead { position: sticky; top: 0; z-index: 10; background-color: var(--color-bg); color: var(--color-text-primary); }
    th > div { display: flex; align-items: center; justify-content: center; }
    td:not(:last-child) { border-right: 1px solid var(--color-border); }
    th:not(:last-child) { border-right: 1px solid var(--color-border); }
    tbody tr:last-child td { border-bottom: none; }
    .sort-indicator { transition: color 0.2s ease; margin-right: 0.5em; font-size: 1.2em; }
    tbody tr:nth-child(even) { background-color: var(--color-row-even-bg); }
    tbody tr:hover { background-color: var(--color-surface-hover); }
    th.is-active { font-weight: 900; color: var(--color-primary); }
    tbody tr td.is-active { background-color: var(--color-active-col-bg); }
    .is-hidden { display: none !important; }
    
    .symbol--warning { color: var(--color-warning); font-weight: 700; }

    .currency-tag { display: inline-block; padding: 4px 10px; border-radius: 6px; font-size: 0.9em; font-weight: 700; line-height: 1.2; border: 1px solid transparent; text-align: center; min-width: 50px; transition: all 0.2s ease; }
    .currency-tag--euro-active { background-color: var(--tag-euro-active-bg); color: var(--tag-euro-active-text); border-color: var(--tag-euro-active-border); }
    .currency-tag--dollar-family { background-color: var(--tag-dollar-bg); color: var(--tag-dollar-text); border-color: var(--tag-dollar-border); }
    .currency-tag--other { background-color: var(--tag-other-bg); color: var(--tag-other-text); border-color: var(--tag-other-border); }
    .currency-tag--note-secondary { background-color: var(--tag-closed-bg); color: var(--tag-closed-text); border-color: var(--tag-closed-border); }
    .currency-tag--eu-national { background-color: var(--tag-national-bg); color: var(--tag-national-text); border-color: var(--tag-national-border); }
    .currency-tag--warning { background-color: var(--tag-warning-bg); color: var(--tag-warning-text); border-color: var(--tag-warning-border); }

    .note-cell-content { display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 4px 8px; }
    td[data-column-id="note"] .note-cell-content,
    td[data-column-id="local"] .note-cell-content { justify-content: flex-start; }
    
    .note-tag { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; font-weight: 700; line-height: 1.4; white-space: nowrap; border: 1px solid transparent; transition: all 0.2s ease; }
    .note-tag[data-tag-group], .currency-tag[data-tag-group] { cursor: pointer; }
    .note-tag[data-tag-group]:hover, .currency-tag[data-tag-group]:hover { transform: translateY(-1px); box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .note-tag.is-active-tag, .currency-tag.is-active-tag { box-shadow: 0 0 0 2px var(--color-tag-active-shadow); }
    
    .note-tag--success { background-color: var(--tag-success-bg); color: var(--tag-success-text); border-color: var(--tag-success-border); }
    .note-tag--danger { background-color: var(--tag-danger-bg); color: var(--tag-danger-text); border-color: var(--tag-danger-border); }
    .note-tag--closed { background-color: var(--tag-closed-bg); color: var(--tag-closed-text); border-color: var(--tag-closed-border); }
    .note-tag--region { background-color: var(--tag-region-bg); color: var(--tag-region-text); border-color: var(--tag-region-border); }
    .note-tag--national { background-color: var(--tag-national-bg); color: var(--tag-national-text); border-color: var(--tag-national-border); }
    .note-tag--external { background-color: var(--tag-dollar-bg); color: var(--tag-dollar-text); border-color: var(--tag-dollar-border); }
    .note-tag--tier-1 { background-color: var(--tag-tier-1-bg); color: var(--tag-tier-1-text); border-color: var(--tag-tier-1-border); }
    .note-tag--tier-2 { background-color: var(--tag-tier-2-bg); color: var(--tag-tier-2-text); border-color: var(--tag-tier-2-border); }
    .note-tag--tier-3 { background-color: var(--tag-tier-3-bg); color: var(--tag-tier-3-text); border-color: var(--tag-tier-3-border); }
    .note-tag--nbsp { background-color: var(--tag-nbsp-bg); color: var(--tag-nbsp-text); border-color: var(--tag-nbsp-border); }
    .note-tag--unique { background-color: var(--tag-unique-bg); color: var(--tag-unique-text); border-color: var(--tag-unique-border); }
    
    th:nth-child(1), td:nth-child(1) { width: 8%; text-align: center;}
    td:nth-child(2), td:nth-child(3), td:nth-child(4) { text-align: left; }
    th:nth-child(2) { width: 20%; } th:nth-child(3) { width: 20%; } th:nth-child(4) { width: 25%; white-space: normal;}
    th:nth-child(5), td:nth-child(5) { width: 12%; }
    th:nth-child(6), td:nth-child(6), th:nth-child(7), td:nth-child(7), th:nth-child(8), td:nth-child(8) { width: 1%; text-align: center; white-space: nowrap; }

    /* CSS: 6. RESPONSIVENESS - REWORKED CARD LAYOUT (FLEXBOX) */
    @media (max-width: 820px) {
      .controls-panel { gap: 0.75em; } 
      #searchInput, label[for="searchInput"] { width: 100%; order: 10; margin-top: 0.5em; }
    
      .table-wrapper { border: none; }
      table, thead, tbody { display: block; }
      thead tr { display: none; }
      
      tbody tr { 
        display: flex;
        flex-wrap: wrap;
        border: 1px solid var(--color-border); 
        border-radius: 8px; 
        margin-bottom: 1rem; 
        background-color: var(--color-surface);
        padding: 1rem;
        gap: 0.5rem 1rem;
      }
      tbody tr:nth-child(even) { background-color: var(--color-surface); }
      
      td { 
        border: none; 
        padding: 0;
        text-align: left;
        display: flex;
        align-items: baseline;
      }
      
      /* Card Header */
      td[data-column-id="valuta"] { order: 1; width: auto; }
      td[data-column-id="country"] { order: 2; flex-grow: 1; border-bottom: 1px solid var(--color-border); padding-bottom: 1rem; margin-bottom: 0.5rem; }
      
      /* Card Body */
      td:not([data-column-id="valuta"]):not([data-column-id="country"]) {
        order: 3;
        width: 100%;
      }
      
      td::before {
        content: attr(data-label);
        font-weight: 600; 
        color: var(--color-text-secondary);
        flex-basis: 75px;
        flex-shrink: 0;
      }

      /* Hide labels for header elements */
      td[data-column-id="valuta"]::before,
      td[data-column-id="country"]::before {
        display: none;
      }
    }
  </style>
</head>
<body>

<!-- BODY: CONTROLS SECTION -->
<header id="controls-section">
    <div class="container">
        <div class="controls-panel">
            <button id="theme-switcher" class="control-btn" title="Switch color theme">
                <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </button>
            <label for="searchInput" class="visually-hidden">Search currency formats</label>
            <input type="search" id="searchInput" placeholder="Search currency formats...">
            <button id="infoBtn" class="control-btn" title="Show Legend"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></button>
            <button id="core-cols-toggle-btn" class="control-btn" title="Toggle technical columns" aria-label="Toggle technical columns visibility"> <svg class="icon-eye" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg> <svg class="icon-eye-off" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg> </button>
            <button id="showAllBtn" class="control-btn" title="Reset view and show all">
                <span class="filter-count"></span>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
            </button>
            <div class="dropdown-wrapper">
              <button id="filter-btn" class="control-btn" title="Filter by value" aria-label="Filter table by selected value">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>
              </button>
              <div id="filter-dropdown" class="dropdown-menu"></div>
            </div>
        </div>
        <!-- LEGEND PANEL: START -->
        <div id="legend-panel" class="legend-panel is-hidden">
           <div class="legend-grid">
               <div class="legend-column">
                   <h4>Info Tags</h4>
                   <div class="legend-item">
                       <div class="legend-item__key"><span class="note-tag note-tag--tier-1">Tier 1</span><span class="note-tag note-tag--tier-2">Tier 2</span>...</div>
                       <div class="legend-item__desc">Business priority level of the market.</div>
                   </div>
                   <div class="legend-item">
                       <div class="legend-item__key"><span class="note-tag note-tag--closed">closed</span></div>
                       <div class="legend-item__desc">Market is currently closed for business.</div>
                   </div>
                   <div class="legend-item">
                       <div class="legend-item__key"><span class="note-tag note-tag--external">external</span></div>
                       <div class="legend-item__desc">Format used outside home country (e.g., A$, CA$).</div>
                   </div>
                   <div class="legend-item">
                       <div class="legend-item__key"><span class="note-tag note-tag--national">national</span></div>
                       <div class="legend-item__desc">EU economic area currency without â‚¬.</div>
                   </div>
               </div>
               <div class="legend-column">
                   <h4>Technical Tags</h4>
                   <div class="legend-item">
                       <div class="legend-item__key"><span class="note-tag note-tag--success">After</span><span class="note-tag note-tag--danger">Before</span></div>
                       <div class="legend-item__desc">Position of the currency symbol relative to the number.</div>
                   </div>
                   <div class="legend-item">
                       <div class="legend-item__key"><span class="note-tag note-tag--danger">Dot</span><span class="note-tag note-tag--success">Comma</span></div>
                       <div class="legend-item__desc">Used for Decimal Separator.</div>
                   </div>
                   <div class="legend-item">
                        <div class="legend-item__key"><span class="note-tag note-tag--success">Dot</span><span class="note-tag note-tag--danger">Comma</span>...</div>
                        <div class="legend-item__desc">Used for thousands separator (includes Space, Unique).</div>
                   </div>
               </div>
           </div>
        </div>
        <!-- LEGEND PANEL: END -->
    </div> 
</header>

<!-- BODY: MAIN CONTENT -->
<main>
    <div class="container">
        <div class="table-wrapper">
            <table id="glossaryTable">
                <thead>
                    <tr>
                        <th data-column-index="1" data-column-id="valuta"><div><span class="sort-indicator" aria-hidden="true">â†•</span><span>Code</span></div></th>
                        <th data-column-index="2" data-column-id="country"><div><span class="sort-indicator" aria-hidden="true">â†•</span><span>Country</span></div></th>
                        <th data-column-index="3" data-column-id="example"><div><span class="sort-indicator" aria-hidden="true">â†•</span><span>Example</span></div></th>
                        <th data-column-index="4" data-column-id="note"><div><span class="sort-indicator" aria-hidden="true">â†•</span><span>Note</span></div></th>
                        <th data-column-index="5" data-column-id="local"><div><span class="sort-indicator" aria-hidden="true">â†•</span><span>Local</span></div></th>
                        <th data-column-index="6" data-column-id="symPos" data-is-core="true"><div><span class="sort-indicator" aria-hidden="true">â†•</span><span>Position</span></div></th>
                        <th data-column-index="7" data-column-id="decSep" data-is-core="true"><div><span class="sort-indicator" aria-hidden="true">â†•</span><span>Decimal</span></div></th>
                        <th data-column-index="8" data-column-id="tdsSep" data-is-core="true"><div><span class="sort-indicator" aria-hidden="true">â†•</span><span>Thds.</span></div></th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>
</main>

<!-- BODY: FOOTER -->
<footer>
    <p>Generated by MAE OMA-II / UXIFE</p>
    <p style="color: var(--color-primary); font-weight: bold;">Â© <span id="copyright-year">2025</span> McBile AI-Engine</p>
</footer>

<!-- BODY: UTILITY BUTTONS -->
<button id="scrollToTopBtn" class="control-btn" title="Scroll to top" aria-label="Scroll to top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg></button>

<script>

(() => {
    // SCRIPT: --- DATA & CONFIG ---
    let currencyData = [
        {valuta:"EUR",country:"ðŸ‡¦ðŸ‡© Andorra (AD)",example:"1.234,56 â‚¬",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"AUD",country:"ðŸ‡¦ðŸ‡º Australia (AU)",example:"$1,234.56",note:"External: A$",local:"en-AU",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"ðŸ‡¦ðŸ‡¹ Austria (AT)",example:"1.234,56 â‚¬",note:"",local:"de",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"EUR",country:"ðŸ‡§ðŸ‡ª Belgium (BE) ðŸ‡«ðŸ‡·",example:"1 234,56 â‚¬",note:"",local:"fr",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"ðŸ‡§ðŸ‡ª Belgium (BE) ðŸ‡³ðŸ‡±",example:"â‚¬ 1.234,56",note:"+ after â‚¬",local:"nl",symPos:"Before",decSep:"COM",tdsSep:"DOT"},
        {valuta:"BRL",country:"ðŸ‡§ðŸ‡· Brazil (BR)",example:"R$ 1.234,56",note:"+after",local:"pt-BR",symPos:"Before",decSep:"COM",tdsSep:"DOT"},
        {valuta:"TRY",country:"ðŸ‡¹ðŸ‡· Turkey (TR)",example:"1.234,56 TL",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"BGN",country:"ðŸ‡§ðŸ‡¬ Bulgaria (BG)",example:"1 234,56 Ð»Ð².",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"CAD",country:"ðŸ‡¨ðŸ‡¦ Canada (CA) ðŸ‡¬ðŸ‡§ ",example:"$1,234.56",note:"External: CA$",local:"en-CA",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"CAD",country:"ðŸ‡¨ðŸ‡¦ Canada (CA) ðŸ‡«ðŸ‡·",example:"$1,234.56",note:"External: CA$",local:"fr-CA",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"ðŸ‡­ðŸ‡· Croatia (HR)",example:"1.234,56 â‚¬",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"EUR",country:"ðŸ‡¨ðŸ‡¾ Cyprus (CY)",example:"1.234,56 â‚¬",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"CZK",country:"ðŸ‡¨ðŸ‡¿ Czechia (CZ)",example:"1 234,56 KÄ",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"DKK",country:"ðŸ‡©ðŸ‡° Denmark (DK)",example:"1.234,56 kr",note:"National DKK",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"EUR",country:"ðŸ‡ªðŸ‡ª Estonia (EE)",example:"1 234,56 â‚¬",note:"",local:"et",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"ðŸ‡«ðŸ‡® Finland (FI)",example:"1 234,56 â‚¬",note:"",local:"fi",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"ðŸ‡«ðŸ‡· France (FR)",example:"1 234,56 â‚¬",note:"",local:"fr",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"ðŸ‡©ðŸ‡ª Germany (DE)",example:"1.234,56 â‚¬",note:"",local:"de",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"USD",country:"ðŸ‡ºðŸ‡¸ GLOBAL (EN)",example:"US$1,234.56",note:"",local:"en",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"ðŸ‡¬ðŸ‡· Greece (GR)",example:"1.234,56 â‚¬",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"HUF",country:"ðŸ‡­ðŸ‡º Hungary (HU)",example:"1 234,56 Ft",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"ISK",country:"ðŸ‡®ðŸ‡¸ Iceland (IS)",example:"1.234,56 kr",note:"National ISK",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"INR",country:"ðŸ‡®ðŸ‡³ India (IN)",example:"â‚¹1,23,456.78",note:"",local:"en",symPos:"Before",decSep:"DOT",tdsSep:"UNQ"},
        {valuta:"EUR",country:"ðŸ‡®ðŸ‡ª Ireland (IE)",example:"â‚¬1,234.56",note:"",local:"en",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"ðŸ‡®ðŸ‡¹ Italy (IT)",example:"1.234,56 â‚¬",note:"",local:"it",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"EUR",country:"ðŸ‡±ðŸ‡» Latvia (LV)",example:"1 234,56 â‚¬",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"CHF",country:"ðŸ‡±ðŸ‡® Liechtenstein (LI)",example:"CHF 1â€™234.56",note:"",local:"de",symPos:"Before",decSep:"DOT",tdsSep:"UNQ"},
        {valuta:"EUR",country:"ðŸ‡±ðŸ‡¹ Lithuania (LT)",example:"1 234,56 â‚¬",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"ðŸ‡±ðŸ‡º Luxembourg (LU) ðŸ‡©ðŸ‡ª",example:"1 234,56 â‚¬",note:"",local:"de",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"ðŸ‡±ðŸ‡º Luxembourg (LU) ðŸ‡«ðŸ‡·",example:"1 234,56 â‚¬",note:"",local:"fr",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"ðŸ‡²ðŸ‡¹ Malta (MT)",example:"â‚¬1,234.56",note:"",local:"en",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"USD",country:"ðŸ‡¸ðŸ‡¦ MENA (AR)",example:"US$ Ù¡Ù¬Ù¢Ù£Ù¤Ù«Ù¥Ù¦",note:"",local:"ar",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"ðŸ‡²ðŸ‡¨ Monaco (MC)",example:"1 234,56 â‚¬",note:"",local:"fr",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"ðŸ‡²ðŸ‡ª Montenegro (ME)",example:"1.234,56 â‚¬",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"USDT",country:"ðŸŒ N/A",example:"1.23456 USDT",note:"",local:"en",symPos:"After",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"ðŸ‡³ðŸ‡± Netherlands (NL)",example:"â‚¬ 1.234,56",note:"+ after â‚¬",local:"nl",symPos:"Before",decSep:"COM",tdsSep:"DOT"},
        {valuta:"NZD",country:"ðŸ‡³ðŸ‡¿ New Zealand (NZ)",example:"$1,234.56",note:"External: NZ$",local:"en-NZ",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"NOK",country:"ðŸ‡³ðŸ‡´ Norway (NO)",example:"1 234,56 kr",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"PLN",country:"ðŸ‡µðŸ‡± Poland (PL)",example:"1 234,56 zÅ‚",note:"National PLN",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"ðŸ‡µðŸ‡¹ Portugal (PT)",example:"1.234,56 â‚¬",note:"",local:"pt",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"RON",country:"ðŸ‡·ðŸ‡´ Romania (RO)",example:"1.234,56 lei",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"EUR",country:"ðŸ‡¸ðŸ‡² San Marino (SM)",example:"1.234,56 â‚¬",note:"",local:"it",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"EUR",country:"ðŸ‡¸ðŸ‡° Slovakia (SK)",example:"1 234,56 â‚¬",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"EUR",country:"ðŸ‡¸ðŸ‡® Slovenia (SI)",example:"1 234,56 â‚¬",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"ZAR",country:"ðŸ‡¿ðŸ‡¦ South Africa (ZA)",example:"R1,234.56",note:"",local:"en-ZA",symPos:"Before",decSep:"DOT",tdsSep:"COM"},
        {valuta:"EUR",country:"ðŸ‡ªðŸ‡¸ Spain (ES)",example:"1.234,56â‚¬",note:"- before â‚¬",local:"es",symPos:"After",decSep:"COM",tdsSep:"DOT"},
        {valuta:"SEK",country:"ðŸ‡¸ðŸ‡ª Sweden (SE)",example:"1 234,56 kr",note:"",local:"en",symPos:"After",decSep:"COM",tdsSep:"SPC"},
        {valuta:"CHF",country:"ðŸ‡¨ðŸ‡­ Switzerland (CH) ðŸ‡©ðŸ‡ª",example:"â‚¬ 1â€™234.56",note:"+ after â‚¬",local:"de",symPos:"Before",decSep:"DOT",tdsSep:"UNQ"},
        {valuta:"CHF",country:"ðŸ‡¨ðŸ‡­ Switzerland (CH) ðŸ‡«ðŸ‡·",example:"â‚¬ 1 234.56",note:"+ after â‚¬",local:"fr",symPos:"Before",decSep:"DOT",tdsSep:"SPC"},
        {valuta:"GBP",country:"ðŸ‡¬ðŸ‡§ United Kingdom (UK)",example:"Â£1,234.56",note:"",local:"en-UK",symPos:"Before",decSep:"DOT",tdsSep:"COM"}
    ];
    
    // SCRIPT: --- CONFIGURATION SETS (SOURCE OF TRUTH) ---
    const TIER_1_CODES = new Set(['AD', 'AU', 'AT', 'BE', 'CA', 'CY', 'DK', 'EE', 'FI', 'FR', 'DE', 'IS', 'IE', 'IT', 'LI', 'LU', 'MT', 'NL', 'NZ', 'NO', 'SM', 'SI', 'ES', 'SE', 'CH', 'UK', 'MC', 'AR']);
    const TIER_2_CODES = new Set(['BG', 'CZ', 'GR', 'HU', 'LV', 'LT', 'ME', 'PL', 'PT', 'RO', 'SK', 'HR']);
    const TIER_3_CODES = new Set(['BR', 'IN', 'ZA', 'TR']);
    const CLOSED_CODES = new Set(['AD', 'BR', 'TR', 'BG', 'HR', 'CY', 'CZ', 'GR', 'HU', 'LV', 'LI', 'LT', 'MC', 'ME', 'RO', 'SM', 'SK', 'SE']);
    const NATIONAL_EUR_MAP = new Map([['CZ','CZK'],['HU','HUF'],['NO','NOK'],['SE','SEK'],['RO','RON'],['BG','BGN'],['LI','CHF'],['CH','CHF'],['PL','PLN'],['IS','ISK'],['DK','DKK']]);
    const EXTERNAL_MAP = new Map([['AU','A$'],['CA','CA$'],['NZ','NZ$']]);
    const DOLLAR_FAMILY = new Set(['AUD', 'CAD', 'NZD', 'USD', 'USDT', 'GBP', 'ZAR']);
    const COLUMN_ID_TO_SORT_KEY = { 
        valuta: 'default', country: 'country', example: 'example', note: 'note_priority',
        local: 'local', symPos: 'symPos', decSep: 'decSep', tdsSep: 'tdsSep'
    };
    
    // SCRIPT: --- DATA TRANSFORMATION ---
    const getCountryCode = (countryString) => { const match = countryString.match(/\((\w{2,3}(?:-\w{2})?)\)/); return match ? match[1].split('-')[0] : null; };

    currencyData.forEach(item => {
        item.countryCode = getCountryCode(item.country);
        item.displayCode = item.valuta;
        if (NATIONAL_EUR_MAP.has(item.countryCode)) {
            item.valuta = "EUR";
            item.displayCode = NATIONAL_EUR_MAP.get(item.countryCode);
        }
    });
    currencyData.forEach(item => {
        if (NATIONAL_EUR_MAP.has(item.countryCode) && item.displayCode !== 'GBP') {
            const tds = item.tdsSep === 'SPC' ? ' ' : (item.tdsSep === 'DOT' ? '.' : (item.tdsSep === 'UNQ' ? 'â€™' : ','));
            const dec = item.decSep === 'COM' ? ',' : '.';
            const baseNumber = `1${tds}234${dec}56`;
            if (item.symPos === 'Before') { item.example = `â‚¬ ${baseNumber}`; } else { item.example = `${baseNumber} â‚¬`; }
        }
    });

    // SCRIPT: --- NOTE INFO PARSER ---
    currencyData.forEach(item => {
        item.noteInfo = { tags: [], text: '' };
        item.searchableTags = [];

        if (TIER_1_CODES.has(item.countryCode)) item.noteInfo.tags.push({ type: 'tier-1', label: 'Tier 1' });
        else if (TIER_2_CODES.has(item.countryCode)) item.noteInfo.tags.push({ type: 'tier-2', label: 'Tier 2' });
        else if (TIER_3_CODES.has(item.countryCode)) item.noteInfo.tags.push({ type: 'tier-3', label: 'Tier 3' });
        
        if (CLOSED_CODES.has(item.countryCode)) item.noteInfo.tags.push({ type: 'closed', label: 'closed' });
        if (NATIONAL_EUR_MAP.has(item.countryCode)) item.noteInfo.tags.push({ type: 'national', label: 'national' });
        if (EXTERNAL_MAP.has(item.countryCode)) {
            item.noteInfo.tags.push({ type: 'external', label: 'external' });
            item.noteInfo.text = EXTERNAL_MAP.get(item.countryCode);
        }
        
        if (item.note.includes("+ after") || item.note.includes("+after") || item.note.includes("- before")) item.noteInfo.tags.push({ type: 'nbsp', label: 'spacing' });

        item.searchableTags = item.noteInfo.tags.map(t => t.label).join(' ').toLowerCase();
    });
    
    document.addEventListener('DOMContentLoaded', () => {
        // SCRIPT: --- DOM ELEMENT REFERENCES ---
        const D = document;
        const htmlElement = D.documentElement;
        const table = D.getElementById('glossaryTable');
        if (!table) return;

        const scrollToTopBtn = D.getElementById('scrollToTopBtn');
        const coreColsToggleBtn = D.getElementById('core-cols-toggle-btn');
        const filterBtn = D.getElementById('filter-btn');
        const searchInput = D.getElementById('searchInput');
        const themeSwitcher = D.getElementById('theme-switcher');
        const showAllBtn = D.getElementById('showAllBtn');
        const infoBtn = D.getElementById('infoBtn');
        const legendPanel = D.getElementById('legend-panel');
        const filterDropdown = D.getElementById('filter-dropdown');
        const tableBody = D.getElementById('tableBody');
        const headers = Array.from(table.querySelectorAll('thead th'));
        const copyrightYearSpan = D.getElementById('copyright-year');

        // SCRIPT: --- STATE MANAGEMENT ---
        let tableConfig = {};
        let activeFilters = {};
        let sortState = {};
        let showClosed = false;
        let coreMasterToggle = true;
        let columnVisibility = {};
        let activeQuickSort = { group: null, value: null };

        // SCRIPT: --- LOCALSTORAGE & HELPERS ---
        const getFromStorage = (key, defaultValue) => { try { const value = localStorage.getItem(key); return value ? JSON.parse(value) : defaultValue; } catch (e) { return defaultValue; } };
        const saveToStorage = (key, value) => localStorage.setItem(key, JSON.stringify(value));
        const getValutaCategory = (item) => {
            if (NATIONAL_EUR_MAP.has(item.countryCode)) return 'National';
            if (item.valuta === 'EUR') return 'EU Family';
            if (DOLLAR_FAMILY.has(item.valuta)) return 'GB Family';
            return 'Other';
        };
        const getNotePriority = (item) => {
            const tags = new Set(item.noteInfo.tags.map(t => t.type));
            if (tags.has('tier-1')) return 1;
            if (tags.has('tier-2')) return 2;
            if (tags.has('tier-3')) return 3;
            if (tags.has('external')) return 4;
            if (tags.has('closed')) return 5;
            if (tags.has('nbsp')) return 6;
            if (tags.has('national')) return 7;
            return 99;
        };
        const checkQuickSort = (item, { group, value }) => {
            if (!group) return false;
            if (group === 'noteInfo') return item.noteInfo.tags.some(tag => tag.type === value);
            if (group === 'valutaCategory') return getValutaCategory(item) === value;
            if (group === 'locale_lang') return item.local.startsWith(value);
            if (group === 'locale_region') return item.local.includes('-');
            return item[group] === value;
        };

        // SCRIPT: --- SORTING LOGIC ---
        const sortFunctions = {
            'default': (a, b) => { const catA = getValutaCategory(a), catB = getValutaCategory(b); return catA.localeCompare(catB) || a.displayCode.localeCompare(b.displayCode); },
            'country': (a, b) => a.country.localeCompare(b.country, 'en'),
            'example': (a, b) => a.example.localeCompare(b.example, 'en'),
            'note_priority': (a, b) => { const pA = getNotePriority(a), pB = getNotePriority(b); return pA !== pB ? pA - pB : a.country.localeCompare(b.country, 'en'); },
            'local': (a, b) => a.local.localeCompare(b.local, 'en'),
            'symPos': (a, b) => a.symPos.localeCompare(b.symPos, 'en'),
            'decSep': (a, b) => a.decSep.localeCompare(b.decSep, 'en'),
            'tdsSep': (a, b) => a.tdsSep.localeCompare(b.tdsSep, 'en')
        };

        // SCRIPT: --- RENDER & VIEW LOGIC ---
        const getBaseStyling = (item) => {
            const classes = { country: '', example: '', valutaTag: '', valutaText: item.displayCode };
            
            if (NATIONAL_EUR_MAP.has(item.countryCode)) {
                classes.valutaTag = 'currency-tag--eu-national';
            } else if (item.valuta === 'EUR' && CLOSED_CODES.has(item.countryCode)) {
                classes.country = 'text-note-secondary';
                classes.example = 'text-note-secondary';
                classes.valutaTag = 'currency-tag--note-secondary';
            } else {
                const category = getValutaCategory(item);
                if (category === 'EU Family') { classes.valutaTag = 'currency-tag--euro-active'; } 
                else if (category === 'GB Family') { classes.valutaTag = 'currency-tag--dollar-family'; } 
                else { classes.valutaTag = 'currency-tag--other'; }
            }
            return { classes };
        };
        const renderNoteCell = (noteInfo) => {
            if (!noteInfo || (!noteInfo.tags.length && !noteInfo.text)) return '';
            let tagsHtml = '';
            noteInfo.tags.forEach(tag => {
                const isActive = activeQuickSort.group === 'noteInfo' && activeQuickSort.value === tag.type;
                const isActiveClass = isActive ? 'is-active-tag' : '';
                const label = tag.type === 'external' ? `External: ${noteInfo.text}` : tag.label;
                tagsHtml += `<span class="note-tag note-tag--${tag.type} ${isActiveClass}" data-tag-group="noteInfo" data-tag-value="${tag.type}">${label}</span>`;
            });
            return `<div class="note-cell-content">${tagsHtml}</div>`;
        };
        const renderLocaleCell = (localeString) => {
            const parts = localeString.split('-');
            const lang = parts[0];
            const region = parts[1] || '';
            
            const langTagIsActive = activeQuickSort.group === 'locale_lang' && activeQuickSort.value === lang ? 'is-active-tag' : '';
            const langTagColor = `var(--tag-${lang}-bg, var(--tag-other-bg))`;
            const langTextColor = `var(--tag-${lang}-text, var(--tag-other-text))`;
            const langBorderColor = `var(--tag-${lang}-border, var(--tag-other-border))`;

            let langHtml = `<span class="note-tag ${langTagIsActive}" style="background-color:${langTagColor}; color:${langTextColor}; border-color:${langBorderColor};" data-tag-group="locale_lang" data-tag-value="${lang}">${lang}</span>`;
            
            let regionHtml = '';
            if (region) {
                const regionTagIsActive = activeQuickSort.group === 'locale_region' ? 'is-active-tag' : '';
                regionHtml = `<span class="note-tag note-tag--region ${regionTagIsActive}" data-tag-group="locale_region" data-tag-value="any">${region}</span>`;
            }

            return `<div class="note-cell-content">${langHtml}${regionHtml}</div>`;
        };
        const renderTable = (data) => {
            let html = '';
            if (data.length === 0) {
                html = `<tr><td colspan="${headers.length}" style="text-align: center; padding: 2rem; color: var(--color-text-secondary);">No records match your criteria.</td></tr>`;
            } else {
                data.forEach(item => {
                    const { classes } = getBaseStyling(item);
                    const noteHtml = renderNoteCell(item.noteInfo);
                    const localeHtml = renderLocaleCell(item.local);
                    const valutaCategory = getValutaCategory(item);
                    const tagIsActive = (group, value) => activeQuickSort.group === group && activeQuickSort.value === value;
                    const valutaTagIsActive = tagIsActive('valutaCategory', valutaCategory) ? 'is-active-tag' : '';
                    
                    // Conditionally wrap the â‚¬ symbol for styling
                    let exampleHtml = item.example;
                    if (item.valuta === 'EUR' && item.symPos === 'Before') {
                        exampleHtml = exampleHtml.replace('â‚¬', '<span class="symbol--warning">â‚¬</span>');
                    }
                    
                    let symPosHtml = '';
                    if (item.symPos === 'After') { symPosHtml = `<span class="note-tag note-tag--success ${tagIsActive('symPos', 'After') ? 'is-active-tag' : ''}" data-tag-group="symPos" data-tag-value="After">After</span>`; } 
                    else { symPosHtml = `<span class="note-tag note-tag--danger ${tagIsActive('symPos', 'Before') ? 'is-active-tag' : ''}" data-tag-group="symPos" data-tag-value="Before">Before</span>`; }
                    
                    let decSepHtml = '';
                    if (item.decSep === 'DOT') { decSepHtml = `<span class="note-tag note-tag--danger ${tagIsActive('decSep', 'DOT') ? 'is-active-tag' : ''}" data-tag-group="decSep" data-tag-value="DOT">Dot</span>`; } 
                    else { decSepHtml = `<span class="note-tag note-tag--success ${tagIsActive('decSep', 'COM') ? 'is-active-tag' : ''}" data-tag-group="decSep" data-tag-value="COM">Comma</span>`; }

                    let tdsSepHtml = '';
                    switch(item.tdsSep) { 
                        case 'SPC': tdsSepHtml = `<span class="note-tag note-tag--nbsp ${tagIsActive('tdsSep', 'SPC') ? 'is-active-tag' : ''}" data-tag-group="tdsSep" data-tag-value="SPC">Space</span>`; break; 
                        case 'UNQ': tdsSepHtml = `<span class="note-tag note-tag--unique ${tagIsActive('tdsSep', 'UNQ') ? 'is-active-tag' : ''}" data-tag-group="tdsSep" data-tag-value="UNQ">Unique</span>`; break; 
                        case 'DOT': tdsSepHtml = `<span class="note-tag note-tag--success ${tagIsActive('tdsSep', 'DOT') ? 'is-active-tag' : ''}" data-tag-group="tdsSep" data-tag-value="DOT">Dot</span>`; break; 
                        default: tdsSepHtml = `<span class="note-tag note-tag--danger ${tagIsActive('tdsSep', 'COM') ? 'is-active-tag' : ''}" data-tag-group="tdsSep" data-tag-value="COM">Comma</span>`; break; 
                    }
                    
                    html += `<tr>
                        <td data-label="Code" data-column-id="valuta"><span class="currency-tag ${classes.valutaTag} ${valutaTagIsActive}" data-tag-group="valutaCategory" data-tag-value="${valutaCategory}">${classes.valutaText}</span></td>
                        <td data-label="Country" data-column-id="country"><span class="${classes.country}">${item.country}</span></td>
                        <td data-label="Example" data-column-id="example"><span class="${classes.example}">${exampleHtml}</span></td>
                        <td data-label="Note" data-column-id="note">${noteHtml}</td>
                        <td data-label="Local" data-column-id="local">${localeHtml}</td>
                        <td data-label="Position" data-column-id="symPos">${symPosHtml}</td>
                        <td data-label="Decimal" data-column-id="decSep">${decSepHtml}</td>
                        <td data-label="Thds." data-column-id="tdsSep">${tdsSepHtml}</td>
                    </tr>`;
                });
            }
            tableBody.innerHTML = html;
        };
        const updateView = () => {
            const searchQuery = searchInput.value.toLowerCase().trim();
            let dataToProcess = showClosed ? currencyData : currencyData.filter(item => !CLOSED_CODES.has(item.countryCode));
            
            let filteredData = dataToProcess.filter(item => {
                const searchHaystack = [Object.values(item).join(' '), item.searchableTags || ''].join(' ').toLowerCase();
                if (searchQuery && !searchHaystack.includes(searchQuery)) return false;
                
                for (const group in activeFilters) {
                    const hiddenValues = activeFilters[group];
                    if (hiddenValues.size === 0) continue;
                    
                    if (group === 'noteTag') {
                        const itemTags = new Set(item.noteInfo.tags.map(t => t.type === 'nbsp' ? 'spacing' : t.label));
                        if ([...itemTags].some(tag => hiddenValues.has(tag))) return false;
                        continue;
                    }

                    let itemValue;
                    if (group === 'codeTag') { itemValue = getValutaCategory(item); } 
                    else if (group === 'currencyName') { itemValue = item.displayCode; } 
                    else if (group === 'country') { itemValue = item.country.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]\s*/g, '').trim(); } 
                    else if (group === 'locale') { itemValue = item.local.split('-')[0]; }
                    
                    if (itemValue && hiddenValues.has(itemValue)) return false;
                }
                return true;
            });
            
            const { key, direction } = sortState;
            const sortFn = sortFunctions[key];
            filteredData.sort((a, b) => {
                if (activeQuickSort.group) {
                    const aHasTag = checkQuickSort(a, activeQuickSort);
                    const bHasTag = checkQuickSort(b, activeQuickSort);
                    if (aHasTag !== bHasTag) return bHasTag - aHasTag;
                }
                const result = sortFn ? sortFn(a, b) : 0;
                return direction === 'asc' ? result : -result;
            });
            
            renderTable(filteredData);
            updateGlobalStateIndicator();
        };

        // SCRIPT: --- UI STATE UPDATERS ---
        const updateGlobalStateIndicator = () => {
            let count = 0;
            Object.values(activeFilters).forEach(filterSet => count += filterSet.size);
            if (activeQuickSort.group) count++;
            if (!coreMasterToggle) count++;
            if(!showClosed && currencyData.some(i => CLOSED_CODES.has(i.countryCode))) count++; 

            const counter = showAllBtn.querySelector('.filter-count');
            counter.textContent = count > 0 ? count : '';
            showAllBtn.classList.toggle('is-active-filter', count > 0);
            updateSortUI();
        };
        const applyColumnVisibility = () => {
            let style = D.getElementById('column-visibility-styles');
            if(!style) { style = D.createElement('style'); style.id = 'column-visibility-styles'; D.head.appendChild(style); }
            const cssRules = [];
            coreColsToggleBtn.dataset.state = coreMasterToggle ? 'visible' : 'hidden';

            Object.entries(columnVisibility).forEach(([colId, isVisible]) => {
                const index = tableConfig.columnIdToIndex[colId];
                if (index) {
                    const displayRule = (coreMasterToggle && isVisible) ? '' : 'display: none !important;';
                    cssRules.push(`th[data-column-index="${index}"], td[data-column-id="${colId}"] { ${displayRule} }`);
                }
            });
            style.textContent = cssRules.join(' ');
            updateGlobalStateIndicator();
        };
        const updateSortUI = () => {
            headers.forEach(h => {
                const headerKey = COLUMN_ID_TO_SORT_KEY[h.dataset.columnId];
                const isActive = headerKey === sortState.key && !activeQuickSort.group;
                h.classList.toggle('is-active', isActive);
                if (isActive) {
                    h.setAttribute('aria-sort', sortState.direction === 'asc' ? 'ascending' : 'descending');
                    h.querySelector('.sort-indicator').textContent = sortState.direction === 'asc' ? 'â–²' : 'â–¼';
                } else {
                    h.removeAttribute('aria-sort');
                    h.querySelector('.sort-indicator').textContent = 'â†•';
                }
            });
        };
        const populateFilterDropdown = () => {
            const filters = {
                codeTag: { title: 'Valuta Tier', values: new Set() },
                noteTag: { title: 'Tags', values: new Set() },
                locale: { title: 'Locale', values: new Set() },
                country: { title: 'Country', values: new Set() },
                currencyName: { title: 'Currency', values: new Set() },
            };

            currencyData.forEach(item => {
                filters.codeTag.values.add(getValutaCategory(item));
                item.noteInfo.tags.forEach(tag => {
                    if (tag.type !== 'national') { filters.noteTag.values.add(tag.type === 'nbsp' ? 'spacing' : tag.label); }
                });
                filters.currencyName.values.add(item.displayCode);
                filters.country.values.add(item.country.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]\s*/g, '').trim());
                filters.locale.values.add(item.local.split('-')[0]);
            });
            
            let html = ``;
            Object.entries(filters).forEach(([key, config]) => {
                if (config.values.size === 0) return;
                const allValues = [...config.values].sort((a,b) => a.localeCompare(b, 'en'));
                const isAllSelected = !activeFilters[key] || activeFilters[key].size === 0;

                let listItems = `<li class="filter-value-item filter-group-select-all"><label><input type="checkbox" data-group="${key}" data-action="select-all" ${isAllSelected ? 'checked' : ''}> Select All</label></li>`;
                listItems += allValues.map(val => `
                    <li class="filter-value-item">
                        <label><input type="checkbox" data-group="${key}" data-value="${val}" ${!activeFilters[key] || !activeFilters[key].has(val) ? 'checked' : ''}> ${val}</label>
                    </li>`).join('');

                html += `<li class="filter-accordion-item">
                    <button class="filter-accordion-header"><h3>${config.title}</h3><span class="filter-accordion-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></span></button>
                    <div class="filter-accordion-content"><ul class="filter-group-list" data-group-id="${key}">${listItems}</ul></div>
                </li>`;
            });

            filterDropdown.innerHTML = `<ul id="filter-list">${html}</ul>`;
        };
        
        // SCRIPT: --- INITIALIZATION ---
        const init = () => {
            const columnIdToIndex = {}; const indexToLabel = {};
            headers.forEach((th, i) => { const index = i + 1; const id = th.dataset.columnId; if (!id) return; columnIdToIndex[id] = index; indexToLabel[index] = th.innerText.replace(/\n/g, ' '); });
            tableConfig = { headers, columnIdToIndex, indexToLabel, defaultSortState: { key: 'default', direction: 'asc' } };
            
            const storedFilters = getFromStorage('activeFilters', {});
            activeFilters = Object.fromEntries(Object.entries(storedFilters).map(([k, v]) => [k, new Set(v)]));
            sortState = getFromStorage('sortState', tableConfig.defaultSortState);
            showClosed = getFromStorage('showClosedState', false);
            const savedTheme = getFromStorage('theme', 'dark'); htmlElement.setAttribute('data-theme', savedTheme);
            copyrightYearSpan.textContent = new Date().getFullYear();
            
            const initialCoreMasterState = getFromStorage('coreMasterToggle', null);
            coreMasterToggle = initialCoreMasterState === null ? (window.innerWidth >= 820) : initialCoreMasterState;
            columnVisibility = getFromStorage('columnVisibility', { symPos: true, decSep: true, tdsSep: true });
            applyColumnVisibility();

            // SCRIPT: --- EVENT LISTENERS ---
            scrollToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
            
            themeSwitcher.addEventListener('click', () => { 
                const newTheme = htmlElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                htmlElement.setAttribute('data-theme', newTheme);
                saveToStorage('theme', newTheme);
            });

            window.addEventListener('scroll', () => { scrollToTopBtn.classList.toggle('is-visible', window.scrollY > 200); });
            
            showAllBtn.addEventListener('click', () => {
                searchInput.value = '';
                activeFilters = {};
                showClosed = true;
                sortState = { ...tableConfig.defaultSortState };
                activeQuickSort = { group: null, value: null };
                coreMasterToggle = true;
                columnVisibility = { symPos: true, decSep: true, tdsSep: true };
                saveToStorage('showClosedState', true);
                saveToStorage('activeFilters', {});
                saveToStorage('sortState', sortState);
                saveToStorage('coreMasterToggle', true);
                saveToStorage('columnVisibility', columnVisibility);
                applyColumnVisibility();
                updateView();
                populateFilterDropdown();
            });
            infoBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                legendPanel.classList.toggle('is-hidden');
                infoBtn.classList.toggle('is-active');
            });
            headers.forEach(header => { 
                header.addEventListener('click', () => { 
                    const sortKey = COLUMN_ID_TO_SORT_KEY[header.dataset.columnId]; 
                    if (!sortKey) return; 
                    
                    activeQuickSort = { group: null, value: null };
                    
                    if (sortState.key === sortKey) {
                        sortState.direction = sortState.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        sortState.key = sortKey;
                        sortState.direction = 'asc';
                    }
                    saveToStorage('sortState', sortState); 
                    updateView(); 
                });
            });
            searchInput.addEventListener('input', () => { showClosed = getFromStorage('showClosedState', false); updateView(); });
            D.addEventListener('click', (e) => { 
                if (!filterDropdown.contains(e.target) && !filterBtn.contains(e.target)) filterDropdown.classList.remove('is-open');
                if (!legendPanel.contains(e.target) && !infoBtn.contains(e.target)) {
                    legendPanel.classList.add('is-hidden');
                    infoBtn.classList.remove('is-active');
                }
            });
            tableBody.addEventListener('click', (e) => {
                const clickedTag = e.target.closest('[data-tag-group]');
                if (!clickedTag) return;
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                const group = clickedTag.dataset.tagGroup;
                const value = clickedTag.dataset.tagValue;

                const isSameTag = activeQuickSort.group === group && activeQuickSort.value === value;
                activeQuickSort = isSameTag ? { group: null, value: null } : { group, value };
                updateView();
            });
            
            filterBtn.addEventListener('click', (e) => { e.stopPropagation(); if (!filterDropdown.classList.contains('is-open')) { populateFilterDropdown(); } filterDropdown.classList.toggle('is-open'); });
            
            filterDropdown.addEventListener('click', e => {
                const header = e.target.closest('.filter-accordion-header');
                if (header) { const item = header.parentElement; item.classList.toggle('is-open'); header.nextElementSibling.style.maxHeight = item.classList.contains('is-open') ? header.nextElementSibling.scrollHeight + 'px' : '0px'; return; }

                const checkbox = e.target.closest('input[type="checkbox"]');
                if (checkbox) {
                    const { group, value, action } = checkbox.dataset;
                    if (!activeFilters[group]) activeFilters[group] = new Set();
                    const list = checkbox.closest('.filter-group-list');
                    
                    if (action === 'select-all') {
                        if (checkbox.checked) {
                            activeFilters[group].clear();
                            list.querySelectorAll('input[data-value]').forEach(cb => cb.checked = true);
                        } else {
                            list.querySelectorAll('input[data-value]').forEach(cb => { activeFilters[group].add(cb.dataset.value); cb.checked = false; });
                        }
                    } else {
                        if (checkbox.checked) { activeFilters[group].delete(value); } 
                        else { activeFilters[group].add(value); }
                        const allCheckboxes = list.querySelectorAll('input[data-value]');
                        const allSelectedCheckbox = list.querySelector('input[data-action="select-all"]');
                        allSelectedCheckbox.checked = ![...allCheckboxes].some(cb => !cb.checked);
                    }
                    saveToStorage('activeFilters', Object.fromEntries(Object.entries(activeFilters).map(([k, v]) => [k, [...v]])));
                    updateView();
                }
            });
            
            coreColsToggleBtn.addEventListener('click', () => { coreMasterToggle = !coreMasterToggle; saveToStorage('coreMasterToggle', coreMasterToggle); applyColumnVisibility(); });
            
            // --- INITIAL RENDER ---
            updateView();
        };
        init();
    });
})();
</script>

</body>
</html>
